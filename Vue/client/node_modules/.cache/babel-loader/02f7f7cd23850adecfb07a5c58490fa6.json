{"ast":null,"code":"import _toConsumableArray from \"D:/Stage/App/xr-place-application/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _asyncToGenerator from \"D:/Stage/App/xr-place-application/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.set.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.for-each.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.regexp.test.js\";\nimport \"regenerator-runtime/runtime.js\";\n// Utilities\nimport { convertToUnit, getScrollParents, hasScrollbar, IN_BROWSER, propsFactory } from \"../../util/index.mjs\";\nimport { effectScope, nextTick, onScopeDispose, watchEffect } from 'vue';\nimport { requestNewFrame } from \"./requestNewFrame.mjs\"; // Types\n\nvar scrollStrategies = {\n  none: null,\n  close: closeScrollStrategy,\n  block: blockScrollStrategy,\n  reposition: repositionScrollStrategy\n};\nexport var makeScrollStrategyProps = propsFactory({\n  scrollStrategy: {\n    type: [String, Function],\n    \"default\": 'block',\n    validator: function validator(val) {\n      return typeof val === 'function' || val in scrollStrategies;\n    }\n  }\n});\nexport function useScrollStrategies(props, data) {\n  if (!IN_BROWSER) return;\n  var scope;\n  watchEffect( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n    var _scope;\n\n    return regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            (_scope = scope) == null ? void 0 : _scope.stop();\n\n            if (data.isActive.value && props.scrollStrategy) {\n              _context.next = 3;\n              break;\n            }\n\n            return _context.abrupt(\"return\");\n\n          case 3:\n            scope = effectScope();\n            _context.next = 6;\n            return nextTick();\n\n          case 6:\n            scope.run(function () {\n              if (typeof props.scrollStrategy === 'function') {\n                props.scrollStrategy(data);\n              } else {\n                var _scrollStrategies$pro;\n\n                (_scrollStrategies$pro = scrollStrategies[props.scrollStrategy]) == null ? void 0 : _scrollStrategies$pro.call(scrollStrategies, data);\n              }\n            });\n\n          case 7:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  })));\n}\n\nfunction closeScrollStrategy(data) {\n  var _data$activatorEl$val;\n\n  function onScroll(e) {\n    data.isActive.value = false;\n  }\n\n  bindScroll((_data$activatorEl$val = data.activatorEl.value) != null ? _data$activatorEl$val : data.contentEl.value, onScroll);\n}\n\nfunction blockScrollStrategy(data) {\n  var _data$root$value;\n\n  var scrollElements = _toConsumableArray(new Set([].concat(_toConsumableArray(getScrollParents(data.activatorEl.value)), _toConsumableArray(getScrollParents(data.contentEl.value))))).filter(function (el) {\n    return !el.classList.contains('v-overlay-scroll-blocked');\n  });\n\n  var scrollbarWidth = window.innerWidth - document.documentElement.offsetWidth;\n\n  var scrollableParent = function (el) {\n    return hasScrollbar(el) && el;\n  }(((_data$root$value = data.root.value) == null ? void 0 : _data$root$value.offsetParent) || document.documentElement);\n\n  if (scrollableParent) {\n    data.root.value.classList.add('v-overlay--scroll-blocked');\n  }\n\n  scrollElements.forEach(function (el, i) {\n    if (el === document.documentElement && /iphone|ipad|ipod/i.test(navigator.userAgent)) {\n      el.style.setProperty('--v-ios-body-scroll-x', convertToUnit(-el.scrollLeft));\n      el.style.setProperty('--v-ios-body-scroll-y', convertToUnit(-el.scrollTop));\n    }\n\n    el.style.setProperty('--v-scrollbar-offset', convertToUnit(scrollbarWidth));\n    el.classList.add('v-overlay-scroll-blocked');\n  });\n  onScopeDispose(function () {\n    scrollElements.forEach(function (el, i) {\n      el.style.removeProperty('--v-ios-body-scroll-x');\n      el.style.removeProperty('--v-ios-body-scroll-y');\n      el.style.removeProperty('--v-scrollbar-offset');\n      el.classList.remove('v-overlay-scroll-blocked');\n    });\n\n    if (scrollableParent) {\n      data.root.value.classList.remove('v-overlay--scroll-blocked');\n    }\n  });\n}\n\nfunction repositionScrollStrategy(data) {\n  var _data$activatorEl$val2;\n\n  var slow = false;\n  var raf = -1;\n\n  function update(e) {\n    requestNewFrame(function () {\n      var _data$updatePosition$, _data$updatePosition;\n\n      var start = performance.now();\n      (_data$updatePosition$ = (_data$updatePosition = data.updatePosition).value) == null ? void 0 : _data$updatePosition$.call(_data$updatePosition, e);\n      var time = performance.now() - start;\n      slow = time / (1000 / 60) > 2;\n    });\n  }\n\n  bindScroll((_data$activatorEl$val2 = data.activatorEl.value) != null ? _data$activatorEl$val2 : data.contentEl.value, function (e) {\n    if (slow) {\n      // If the position calculation is slow,\n      // defer updates until scrolling is finished.\n      // Browsers usually fire one scroll event per frame so\n      // we just wait until we've got two frames without an event\n      cancelAnimationFrame(raf);\n      raf = requestAnimationFrame(function () {\n        raf = requestAnimationFrame(function () {\n          update(e);\n        });\n      });\n    } else {\n      update(e);\n    }\n  });\n}\n/** @private */\n\n\nfunction bindScroll(el, onScroll) {\n  var scrollElements = [document].concat(_toConsumableArray(getScrollParents(el)));\n  scrollElements.forEach(function (el) {\n    el.addEventListener('scroll', onScroll, {\n      passive: true\n    });\n  });\n  onScopeDispose(function () {\n    scrollElements.forEach(function (el) {\n      el.removeEventListener('scroll', onScroll);\n    });\n  });\n}","map":{"version":3,"mappings":"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","names":["convertToUnit","getScrollParents","hasScrollbar","IN_BROWSER","propsFactory","effectScope","nextTick","onScopeDispose","watchEffect","requestNewFrame","scrollStrategies","none","close","closeScrollStrategy","block","blockScrollStrategy","reposition","repositionScrollStrategy","makeScrollStrategyProps","scrollStrategy","type","String","Function","default","validator","val","useScrollStrategies","props","data","scope","stop","isActive","value","run","onScroll","e","bindScroll","activatorEl","contentEl","scrollElements","Set","filter","el","classList","contains","scrollbarWidth","window","innerWidth","document","documentElement","offsetWidth","scrollableParent","root","offsetParent","add","forEach","i","test","navigator","userAgent","style","setProperty","scrollLeft","scrollTop","removeProperty","remove","slow","raf","update","start","performance","now","updatePosition","time","cancelAnimationFrame","requestAnimationFrame","addEventListener","passive","removeEventListener"],"sources":["../../../src/components/VOverlay/scrollStrategies.ts"],"sourcesContent":["// Utilities\nimport { convertToUnit, getScrollParents, hasScrollbar, IN_BROWSER, propsFactory } from '@/util'\nimport { effectScope, nextTick, onScopeDispose, watchEffect } from 'vue'\nimport { requestNewFrame } from './requestNewFrame'\n\n// Types\nimport type { EffectScope, PropType, Ref } from 'vue'\n\nexport interface ScrollStrategyData {\n  root: Ref<HTMLElement | undefined>\n  contentEl: Ref<HTMLElement | undefined>\n  activatorEl: Ref<HTMLElement | undefined>\n  isActive: Ref<boolean>\n  updatePosition: Ref<((e: Event) => void) | undefined>\n}\n\nconst scrollStrategies = {\n  none: null,\n  close: closeScrollStrategy,\n  block: blockScrollStrategy,\n  reposition: repositionScrollStrategy,\n}\n\ninterface StrategyProps {\n  scrollStrategy: keyof typeof scrollStrategies | ((data: ScrollStrategyData) => void)\n}\n\nexport const makeScrollStrategyProps = propsFactory({\n  scrollStrategy: {\n    type: [String, Function] as PropType<StrategyProps['scrollStrategy']>,\n    default: 'block',\n    validator: (val: any) => typeof val === 'function' || val in scrollStrategies,\n  },\n})\n\nexport function useScrollStrategies (\n  props: StrategyProps,\n  data: ScrollStrategyData\n) {\n  if (!IN_BROWSER) return\n\n  let scope: EffectScope | undefined\n  watchEffect(async () => {\n    scope?.stop()\n\n    if (!(data.isActive.value && props.scrollStrategy)) return\n\n    scope = effectScope()\n    await nextTick()\n    scope.run(() => {\n      if (typeof props.scrollStrategy === 'function') {\n        props.scrollStrategy(data)\n      } else {\n        scrollStrategies[props.scrollStrategy]?.(data)\n      }\n    })\n  })\n}\n\nfunction closeScrollStrategy (data: ScrollStrategyData) {\n  function onScroll (e: Event) {\n    data.isActive.value = false\n  }\n\n  bindScroll(data.activatorEl.value ?? data.contentEl.value, onScroll)\n}\n\nfunction blockScrollStrategy (data: ScrollStrategyData) {\n  const scrollElements = [...new Set([\n    ...getScrollParents(data.activatorEl.value),\n    ...getScrollParents(data.contentEl.value),\n  ])].filter(el => !el.classList.contains('v-overlay-scroll-blocked'))\n  const scrollbarWidth = window.innerWidth - document.documentElement.offsetWidth\n\n  const scrollableParent = (el => hasScrollbar(el) && el)(data.root.value?.offsetParent || document.documentElement)\n  if (scrollableParent) {\n    data.root.value!.classList.add('v-overlay--scroll-blocked')\n  }\n\n  scrollElements.forEach((el, i) => {\n    if (el === document.documentElement && /iphone|ipad|ipod/i.test(navigator.userAgent)) {\n      el.style.setProperty('--v-ios-body-scroll-x', convertToUnit(-el.scrollLeft))\n      el.style.setProperty('--v-ios-body-scroll-y', convertToUnit(-el.scrollTop))\n    }\n    el.style.setProperty('--v-scrollbar-offset', convertToUnit(scrollbarWidth))\n    el.classList.add('v-overlay-scroll-blocked')\n  })\n\n  onScopeDispose(() => {\n    scrollElements.forEach((el, i) => {\n      el.style.removeProperty('--v-ios-body-scroll-x')\n      el.style.removeProperty('--v-ios-body-scroll-y')\n      el.style.removeProperty('--v-scrollbar-offset')\n      el.classList.remove('v-overlay-scroll-blocked')\n    })\n    if (scrollableParent) {\n      data.root.value!.classList.remove('v-overlay--scroll-blocked')\n    }\n  })\n}\n\nfunction repositionScrollStrategy (data: ScrollStrategyData) {\n  let slow = false\n  let raf = -1\n\n  function update (e: Event) {\n    requestNewFrame(() => {\n      const start = performance.now()\n      data.updatePosition.value?.(e)\n      const time = performance.now() - start\n      slow = time / (1000 / 60) > 2\n    })\n  }\n\n  bindScroll(data.activatorEl.value ?? data.contentEl.value, e => {\n    if (slow) {\n      // If the position calculation is slow,\n      // defer updates until scrolling is finished.\n      // Browsers usually fire one scroll event per frame so\n      // we just wait until we've got two frames without an event\n      cancelAnimationFrame(raf)\n      raf = requestAnimationFrame(() => {\n        raf = requestAnimationFrame(() => {\n          update(e)\n        })\n      })\n    } else {\n      update(e)\n    }\n  })\n}\n\n/** @private */\nfunction bindScroll (el: HTMLElement | undefined, onScroll: (e: Event) => void) {\n  const scrollElements = [document, ...getScrollParents(el)]\n  scrollElements.forEach(el => {\n    el.addEventListener('scroll', onScroll, { passive: true })\n  })\n\n  onScopeDispose(() => {\n    scrollElements.forEach(el => {\n      el.removeEventListener('scroll', onScroll)\n    })\n  })\n}\n"]},"metadata":{},"sourceType":"module"}