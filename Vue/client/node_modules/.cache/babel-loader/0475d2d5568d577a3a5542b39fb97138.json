{"ast":null,"code":"'use strict';\n/**\n * Allows to drag and zoom svg elements\n */\n\nrequire(\"core-js/modules/es.error.cause.js\");\n\nvar wheel = require('wheel');\n\nvar animate = require('amator');\n\nvar eventify = require('ngraph.events');\n\nvar kinetic = require('./lib/kinetic.js');\n\nvar createTextSelectionInterceptor = require('./lib/createTextSelectionInterceptor.js');\n\nvar domTextSelectionInterceptor = createTextSelectionInterceptor();\nvar fakeTextSelectorInterceptor = createTextSelectionInterceptor(true);\n\nvar Transform = require('./lib/transform.js');\n\nvar makeSvgController = require('./lib/svgController.js');\n\nvar makeDomController = require('./lib/domController.js');\n\nvar defaultZoomSpeed = 1;\nvar defaultDoubleTapZoomSpeed = 1.75;\nvar doubleTapSpeedInMS = 300;\nmodule.exports = createPanZoom;\n/**\n * Creates a new instance of panzoom, so that an object can be panned and zoomed\n *\n * @param {DOMElement} domElement where panzoom should be attached.\n * @param {Object} options that configure behavior.\n */\n\nfunction createPanZoom(domElement, options) {\n  options = options || {};\n  var panController = options.controller;\n\n  if (!panController) {\n    if (makeSvgController.canAttach(domElement)) {\n      panController = makeSvgController(domElement, options);\n    } else if (makeDomController.canAttach(domElement)) {\n      panController = makeDomController(domElement, options);\n    }\n  }\n\n  if (!panController) {\n    throw new Error('Cannot create panzoom for the current type of dom element');\n  }\n\n  var owner = panController.getOwner(); // just to avoid GC pressure, every time we do intermediate transform\n  // we return this object. For internal use only. Never give it back to the consumer of this library\n\n  var storedCTMResult = {\n    x: 0,\n    y: 0\n  };\n  var isDirty = false;\n  var transform = new Transform();\n\n  if (panController.initTransform) {\n    panController.initTransform(transform);\n  }\n\n  var filterKey = typeof options.filterKey === 'function' ? options.filterKey : noop; // TODO: likely need to unite pinchSpeed with zoomSpeed\n\n  var pinchSpeed = typeof options.pinchSpeed === 'number' ? options.pinchSpeed : 1;\n  var bounds = options.bounds;\n  var maxZoom = typeof options.maxZoom === 'number' ? options.maxZoom : Number.POSITIVE_INFINITY;\n  var minZoom = typeof options.minZoom === 'number' ? options.minZoom : 0;\n  var boundsPadding = typeof options.boundsPadding === 'number' ? options.boundsPadding : 0.05;\n  var zoomDoubleClickSpeed = typeof options.zoomDoubleClickSpeed === 'number' ? options.zoomDoubleClickSpeed : defaultDoubleTapZoomSpeed;\n  var beforeWheel = options.beforeWheel || noop;\n  var beforeMouseDown = options.beforeMouseDown || noop;\n  var speed = typeof options.zoomSpeed === 'number' ? options.zoomSpeed : defaultZoomSpeed;\n  var transformOrigin = parseTransformOrigin(options.transformOrigin);\n  var textSelection = options.enableTextSelection ? fakeTextSelectorInterceptor : domTextSelectionInterceptor;\n  validateBounds(bounds);\n\n  if (options.autocenter) {\n    autocenter();\n  }\n\n  var frameAnimation;\n  var lastTouchEndTime = 0;\n  var lastSingleFingerOffset;\n  var touchInProgress = false; // We only need to fire panstart when actual move happens\n\n  var panstartFired = false; // cache mouse coordinates here\n\n  var mouseX;\n  var mouseY;\n  var pinchZoomLength;\n  var smoothScroll;\n\n  if ('smoothScroll' in options && !options.smoothScroll) {\n    // If user explicitly asked us not to use smooth scrolling, we obey\n    smoothScroll = rigidScroll();\n  } else {\n    // otherwise we use forward smoothScroll settings to kinetic API\n    // which makes scroll smoothing.\n    smoothScroll = kinetic(getPoint, scroll, options.smoothScroll);\n  }\n\n  var moveByAnimation;\n  var zoomToAnimation;\n  var multiTouch;\n  var paused = false;\n  listenForEvents();\n  var api = {\n    dispose: dispose,\n    moveBy: internalMoveBy,\n    moveTo: moveTo,\n    smoothMoveTo: smoothMoveTo,\n    centerOn: centerOn,\n    zoomTo: publicZoomTo,\n    zoomAbs: zoomAbs,\n    smoothZoom: smoothZoom,\n    smoothZoomAbs: smoothZoomAbs,\n    showRectangle: showRectangle,\n    pause: pause,\n    resume: resume,\n    isPaused: isPaused,\n    getTransform: getTransformModel,\n    getMinZoom: getMinZoom,\n    setMinZoom: setMinZoom,\n    getMaxZoom: getMaxZoom,\n    setMaxZoom: setMaxZoom,\n    getTransformOrigin: getTransformOrigin,\n    setTransformOrigin: setTransformOrigin,\n    getZoomSpeed: getZoomSpeed,\n    setZoomSpeed: setZoomSpeed\n  };\n  eventify(api);\n  var initialX = typeof options.initialX === 'number' ? options.initialX : transform.x;\n  var initialY = typeof options.initialY === 'number' ? options.initialY : transform.y;\n  var initialZoom = typeof options.initialZoom === 'number' ? options.initialZoom : transform.scale;\n\n  if (initialX != transform.x || initialY != transform.y || initialZoom != transform.scale) {\n    zoomAbs(initialX, initialY, initialZoom);\n  }\n\n  return api;\n\n  function pause() {\n    releaseEvents();\n    paused = true;\n  }\n\n  function resume() {\n    if (paused) {\n      listenForEvents();\n      paused = false;\n    }\n  }\n\n  function isPaused() {\n    return paused;\n  }\n\n  function showRectangle(rect) {\n    // TODO: this duplicates autocenter. I think autocenter should go.\n    var clientRect = owner.getBoundingClientRect();\n    var size = transformToScreen(clientRect.width, clientRect.height);\n    var rectWidth = rect.right - rect.left;\n    var rectHeight = rect.bottom - rect.top;\n\n    if (!Number.isFinite(rectWidth) || !Number.isFinite(rectHeight)) {\n      throw new Error('Invalid rectangle');\n    }\n\n    var dw = size.x / rectWidth;\n    var dh = size.y / rectHeight;\n    var scale = Math.min(dw, dh);\n    transform.x = -(rect.left + rectWidth / 2) * scale + size.x / 2;\n    transform.y = -(rect.top + rectHeight / 2) * scale + size.y / 2;\n    transform.scale = scale;\n  }\n\n  function transformToScreen(x, y) {\n    if (panController.getScreenCTM) {\n      var parentCTM = panController.getScreenCTM();\n      var parentScaleX = parentCTM.a;\n      var parentScaleY = parentCTM.d;\n      var parentOffsetX = parentCTM.e;\n      var parentOffsetY = parentCTM.f;\n      storedCTMResult.x = x * parentScaleX - parentOffsetX;\n      storedCTMResult.y = y * parentScaleY - parentOffsetY;\n    } else {\n      storedCTMResult.x = x;\n      storedCTMResult.y = y;\n    }\n\n    return storedCTMResult;\n  }\n\n  function autocenter() {\n    var w; // width of the parent\n\n    var h; // height of the parent\n\n    var left = 0;\n    var top = 0;\n    var sceneBoundingBox = getBoundingBox();\n\n    if (sceneBoundingBox) {\n      // If we have bounding box - use it.\n      left = sceneBoundingBox.left;\n      top = sceneBoundingBox.top;\n      w = sceneBoundingBox.right - sceneBoundingBox.left;\n      h = sceneBoundingBox.bottom - sceneBoundingBox.top;\n    } else {\n      // otherwise just use whatever space we have\n      var ownerRect = owner.getBoundingClientRect();\n      w = ownerRect.width;\n      h = ownerRect.height;\n    }\n\n    var bbox = panController.getBBox();\n\n    if (bbox.width === 0 || bbox.height === 0) {\n      // we probably do not have any elements in the SVG\n      // just bail out;\n      return;\n    }\n\n    var dh = h / bbox.height;\n    var dw = w / bbox.width;\n    var scale = Math.min(dw, dh);\n    transform.x = -(bbox.left + bbox.width / 2) * scale + w / 2 + left;\n    transform.y = -(bbox.top + bbox.height / 2) * scale + h / 2 + top;\n    transform.scale = scale;\n  }\n\n  function getTransformModel() {\n    // TODO: should this be read only?\n    return transform;\n  }\n\n  function getMinZoom() {\n    return minZoom;\n  }\n\n  function setMinZoom(newMinZoom) {\n    minZoom = newMinZoom;\n  }\n\n  function getMaxZoom() {\n    return maxZoom;\n  }\n\n  function setMaxZoom(newMaxZoom) {\n    maxZoom = newMaxZoom;\n  }\n\n  function getTransformOrigin() {\n    return transformOrigin;\n  }\n\n  function setTransformOrigin(newTransformOrigin) {\n    transformOrigin = parseTransformOrigin(newTransformOrigin);\n  }\n\n  function getZoomSpeed() {\n    return speed;\n  }\n\n  function setZoomSpeed(newSpeed) {\n    if (!Number.isFinite(newSpeed)) {\n      throw new Error('Zoom speed should be a number');\n    }\n\n    speed = newSpeed;\n  }\n\n  function getPoint() {\n    return {\n      x: transform.x,\n      y: transform.y\n    };\n  }\n\n  function moveTo(x, y) {\n    transform.x = x;\n    transform.y = y;\n    keepTransformInsideBounds();\n    triggerEvent('pan');\n    makeDirty();\n  }\n\n  function moveBy(dx, dy) {\n    moveTo(transform.x + dx, transform.y + dy);\n  }\n\n  function keepTransformInsideBounds() {\n    var boundingBox = getBoundingBox();\n    if (!boundingBox) return;\n    var adjusted = false;\n    var clientRect = getClientRect();\n    var diff = boundingBox.left - clientRect.right;\n\n    if (diff > 0) {\n      transform.x += diff;\n      adjusted = true;\n    } // check the other side:\n\n\n    diff = boundingBox.right - clientRect.left;\n\n    if (diff < 0) {\n      transform.x += diff;\n      adjusted = true;\n    } // y axis:\n\n\n    diff = boundingBox.top - clientRect.bottom;\n\n    if (diff > 0) {\n      // we adjust transform, so that it matches exactly our bounding box:\n      // transform.y = boundingBox.top - (boundingBox.height + boundingBox.y) * transform.scale =>\n      // transform.y = boundingBox.top - (clientRect.bottom - transform.y) =>\n      // transform.y = diff + transform.y =>\n      transform.y += diff;\n      adjusted = true;\n    }\n\n    diff = boundingBox.bottom - clientRect.top;\n\n    if (diff < 0) {\n      transform.y += diff;\n      adjusted = true;\n    }\n\n    return adjusted;\n  }\n  /**\n   * Returns bounding box that should be used to restrict scene movement.\n   */\n\n\n  function getBoundingBox() {\n    if (!bounds) return; // client does not want to restrict movement\n\n    if (typeof bounds === 'boolean') {\n      // for boolean type we use parent container bounds\n      var ownerRect = owner.getBoundingClientRect();\n      var sceneWidth = ownerRect.width;\n      var sceneHeight = ownerRect.height;\n      return {\n        left: sceneWidth * boundsPadding,\n        top: sceneHeight * boundsPadding,\n        right: sceneWidth * (1 - boundsPadding),\n        bottom: sceneHeight * (1 - boundsPadding)\n      };\n    }\n\n    return bounds;\n  }\n\n  function getClientRect() {\n    var bbox = panController.getBBox();\n    var leftTop = client(bbox.left, bbox.top);\n    return {\n      left: leftTop.x,\n      top: leftTop.y,\n      right: bbox.width * transform.scale + leftTop.x,\n      bottom: bbox.height * transform.scale + leftTop.y\n    };\n  }\n\n  function client(x, y) {\n    return {\n      x: x * transform.scale + transform.x,\n      y: y * transform.scale + transform.y\n    };\n  }\n\n  function makeDirty() {\n    isDirty = true;\n    frameAnimation = window.requestAnimationFrame(frame);\n  }\n\n  function zoomByRatio(clientX, clientY, ratio) {\n    if (isNaN(clientX) || isNaN(clientY) || isNaN(ratio)) {\n      throw new Error('zoom requires valid numbers');\n    }\n\n    var newScale = transform.scale * ratio;\n\n    if (newScale < minZoom) {\n      if (transform.scale === minZoom) return;\n      ratio = minZoom / transform.scale;\n    }\n\n    if (newScale > maxZoom) {\n      if (transform.scale === maxZoom) return;\n      ratio = maxZoom / transform.scale;\n    }\n\n    var size = transformToScreen(clientX, clientY);\n    transform.x = size.x - ratio * (size.x - transform.x);\n    transform.y = size.y - ratio * (size.y - transform.y); // TODO: https://github.com/anvaka/panzoom/issues/112\n\n    if (bounds && boundsPadding === 1 && minZoom === 1) {\n      transform.scale *= ratio;\n      keepTransformInsideBounds();\n    } else {\n      var transformAdjusted = keepTransformInsideBounds();\n      if (!transformAdjusted) transform.scale *= ratio;\n    }\n\n    triggerEvent('zoom');\n    makeDirty();\n  }\n\n  function zoomAbs(clientX, clientY, zoomLevel) {\n    var ratio = zoomLevel / transform.scale;\n    zoomByRatio(clientX, clientY, ratio);\n  }\n\n  function centerOn(ui) {\n    var parent = ui.ownerSVGElement;\n    if (!parent) throw new Error('ui element is required to be within the scene'); // TODO: should i use controller's screen CTM?\n\n    var clientRect = ui.getBoundingClientRect();\n    var cx = clientRect.left + clientRect.width / 2;\n    var cy = clientRect.top + clientRect.height / 2;\n    var container = parent.getBoundingClientRect();\n    var dx = container.width / 2 - cx;\n    var dy = container.height / 2 - cy;\n    internalMoveBy(dx, dy, true);\n  }\n\n  function smoothMoveTo(x, y) {\n    internalMoveBy(x - transform.x, y - transform.y, true);\n  }\n\n  function internalMoveBy(dx, dy, smooth) {\n    if (!smooth) {\n      return moveBy(dx, dy);\n    }\n\n    if (moveByAnimation) moveByAnimation.cancel();\n    var from = {\n      x: 0,\n      y: 0\n    };\n    var to = {\n      x: dx,\n      y: dy\n    };\n    var lastX = 0;\n    var lastY = 0;\n    moveByAnimation = animate(from, to, {\n      step: function (v) {\n        moveBy(v.x - lastX, v.y - lastY);\n        lastX = v.x;\n        lastY = v.y;\n      }\n    });\n  }\n\n  function scroll(x, y) {\n    cancelZoomAnimation();\n    moveTo(x, y);\n  }\n\n  function dispose() {\n    releaseEvents();\n  }\n\n  function listenForEvents() {\n    owner.addEventListener('mousedown', onMouseDown, {\n      passive: false\n    });\n    owner.addEventListener('dblclick', onDoubleClick, {\n      passive: false\n    });\n    owner.addEventListener('touchstart', onTouch, {\n      passive: false\n    });\n    owner.addEventListener('keydown', onKeyDown, {\n      passive: false\n    }); // Need to listen on the owner container, so that we are not limited\n    // by the size of the scrollable domElement\n\n    wheel.addWheelListener(owner, onMouseWheel, {\n      passive: false\n    });\n    makeDirty();\n  }\n\n  function releaseEvents() {\n    wheel.removeWheelListener(owner, onMouseWheel);\n    owner.removeEventListener('mousedown', onMouseDown);\n    owner.removeEventListener('keydown', onKeyDown);\n    owner.removeEventListener('dblclick', onDoubleClick);\n    owner.removeEventListener('touchstart', onTouch);\n\n    if (frameAnimation) {\n      window.cancelAnimationFrame(frameAnimation);\n      frameAnimation = 0;\n    }\n\n    smoothScroll.cancel();\n    releaseDocumentMouse();\n    releaseTouches();\n    textSelection.release();\n    triggerPanEnd();\n  }\n\n  function frame() {\n    if (isDirty) applyTransform();\n  }\n\n  function applyTransform() {\n    isDirty = false; // TODO: Should I allow to cancel this?\n\n    panController.applyTransform(transform);\n    triggerEvent('transform');\n    frameAnimation = 0;\n  }\n\n  function onKeyDown(e) {\n    var x = 0,\n        y = 0,\n        z = 0;\n\n    if (e.keyCode === 38) {\n      y = 1; // up\n    } else if (e.keyCode === 40) {\n      y = -1; // down\n    } else if (e.keyCode === 37) {\n      x = 1; // left\n    } else if (e.keyCode === 39) {\n      x = -1; // right\n    } else if (e.keyCode === 189 || e.keyCode === 109) {\n      // DASH or SUBTRACT\n      z = 1; // `-` -  zoom out\n    } else if (e.keyCode === 187 || e.keyCode === 107) {\n      // EQUAL SIGN or ADD\n      z = -1; // `=` - zoom in (equal sign on US layout is under `+`)\n    }\n\n    if (filterKey(e, x, y, z)) {\n      // They don't want us to handle the key: https://github.com/anvaka/panzoom/issues/45\n      return;\n    }\n\n    if (x || y) {\n      e.preventDefault();\n      e.stopPropagation();\n      var clientRect = owner.getBoundingClientRect(); // movement speed should be the same in both X and Y direction:\n\n      var offset = Math.min(clientRect.width, clientRect.height);\n      var moveSpeedRatio = 0.05;\n      var dx = offset * moveSpeedRatio * x;\n      var dy = offset * moveSpeedRatio * y; // TODO: currently we do not animate this. It could be better to have animation\n\n      internalMoveBy(dx, dy);\n    }\n\n    if (z) {\n      var scaleMultiplier = getScaleMultiplier(z * 100);\n      var offset = transformOrigin ? getTransformOriginOffset() : midPoint();\n      publicZoomTo(offset.x, offset.y, scaleMultiplier);\n    }\n  }\n\n  function midPoint() {\n    var ownerRect = owner.getBoundingClientRect();\n    return {\n      x: ownerRect.width / 2,\n      y: ownerRect.height / 2\n    };\n  }\n\n  function onTouch(e) {\n    // let the override the touch behavior\n    beforeTouch(e);\n\n    if (e.touches.length === 1) {\n      return handleSingleFingerTouch(e, e.touches[0]);\n    } else if (e.touches.length === 2) {\n      // handleTouchMove() will care about pinch zoom.\n      pinchZoomLength = getPinchZoomLength(e.touches[0], e.touches[1]);\n      multiTouch = true;\n      startTouchListenerIfNeeded();\n    }\n  }\n\n  function beforeTouch(e) {\n    // TODO: Need to unify this filtering names. E.g. use `beforeTouch`\n    if (options.onTouch && !options.onTouch(e)) {\n      // if they return `false` from onTouch, we don't want to stop\n      // events propagation. Fixes https://github.com/anvaka/panzoom/issues/12\n      return;\n    }\n\n    e.stopPropagation();\n    e.preventDefault();\n  }\n\n  function beforeDoubleClick(e) {\n    // TODO: Need to unify this filtering names. E.g. use `beforeDoubleClick``\n    if (options.onDoubleClick && !options.onDoubleClick(e)) {\n      // if they return `false` from onTouch, we don't want to stop\n      // events propagation. Fixes https://github.com/anvaka/panzoom/issues/46\n      return;\n    }\n\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  function handleSingleFingerTouch(e) {\n    var touch = e.touches[0];\n    var offset = getOffsetXY(touch);\n    lastSingleFingerOffset = offset;\n    var point = transformToScreen(offset.x, offset.y);\n    mouseX = point.x;\n    mouseY = point.y;\n    smoothScroll.cancel();\n    startTouchListenerIfNeeded();\n  }\n\n  function startTouchListenerIfNeeded() {\n    if (touchInProgress) {\n      // no need to do anything, as we already listen to events;\n      return;\n    }\n\n    touchInProgress = true;\n    document.addEventListener('touchmove', handleTouchMove);\n    document.addEventListener('touchend', handleTouchEnd);\n    document.addEventListener('touchcancel', handleTouchEnd);\n  }\n\n  function handleTouchMove(e) {\n    if (e.touches.length === 1) {\n      e.stopPropagation();\n      var touch = e.touches[0];\n      var offset = getOffsetXY(touch);\n      var point = transformToScreen(offset.x, offset.y);\n      var dx = point.x - mouseX;\n      var dy = point.y - mouseY;\n\n      if (dx !== 0 && dy !== 0) {\n        triggerPanStart();\n      }\n\n      mouseX = point.x;\n      mouseY = point.y;\n      internalMoveBy(dx, dy);\n    } else if (e.touches.length === 2) {\n      // it's a zoom, let's find direction\n      multiTouch = true;\n      var t1 = e.touches[0];\n      var t2 = e.touches[1];\n      var currentPinchLength = getPinchZoomLength(t1, t2); // since the zoom speed is always based on distance from 1, we need to apply\n      // pinch speed only on that distance from 1:\n\n      var scaleMultiplier = 1 + (currentPinchLength / pinchZoomLength - 1) * pinchSpeed;\n      var firstTouchPoint = getOffsetXY(t1);\n      var secondTouchPoint = getOffsetXY(t2);\n      mouseX = (firstTouchPoint.x + secondTouchPoint.x) / 2;\n      mouseY = (firstTouchPoint.y + secondTouchPoint.y) / 2;\n\n      if (transformOrigin) {\n        var offset = getTransformOriginOffset();\n        mouseX = offset.x;\n        mouseY = offset.y;\n      }\n\n      publicZoomTo(mouseX, mouseY, scaleMultiplier);\n      pinchZoomLength = currentPinchLength;\n      e.stopPropagation();\n      e.preventDefault();\n    }\n  }\n\n  function handleTouchEnd(e) {\n    if (e.touches.length > 0) {\n      var offset = getOffsetXY(e.touches[0]);\n      var point = transformToScreen(offset.x, offset.y);\n      mouseX = point.x;\n      mouseY = point.y;\n    } else {\n      var now = new Date();\n\n      if (now - lastTouchEndTime < doubleTapSpeedInMS) {\n        if (transformOrigin) {\n          var offset = getTransformOriginOffset();\n          smoothZoom(offset.x, offset.y, zoomDoubleClickSpeed);\n        } else {\n          // We want untransformed x/y here.\n          smoothZoom(lastSingleFingerOffset.x, lastSingleFingerOffset.y, zoomDoubleClickSpeed);\n        }\n      }\n\n      lastTouchEndTime = now;\n      triggerPanEnd();\n      releaseTouches();\n    }\n  }\n\n  function getPinchZoomLength(finger1, finger2) {\n    var dx = finger1.clientX - finger2.clientX;\n    var dy = finger1.clientY - finger2.clientY;\n    return Math.sqrt(dx * dx + dy * dy);\n  }\n\n  function onDoubleClick(e) {\n    beforeDoubleClick(e);\n    var offset = getOffsetXY(e);\n\n    if (transformOrigin) {\n      // TODO: looks like this is duplicated in the file.\n      // Need to refactor\n      offset = getTransformOriginOffset();\n    }\n\n    smoothZoom(offset.x, offset.y, zoomDoubleClickSpeed);\n  }\n\n  function onMouseDown(e) {\n    // if client does not want to handle this event - just ignore the call\n    if (beforeMouseDown(e)) return;\n\n    if (touchInProgress) {\n      // modern browsers will fire mousedown for touch events too\n      // we do not want this: touch is handled separately.\n      e.stopPropagation();\n      return false;\n    } // for IE, left click == 1\n    // for Firefox, left click == 0\n\n\n    var isLeftButton = e.button === 1 && window.event !== null || e.button === 0;\n    if (!isLeftButton) return;\n    smoothScroll.cancel();\n    var offset = getOffsetXY(e);\n    var point = transformToScreen(offset.x, offset.y);\n    mouseX = point.x;\n    mouseY = point.y; // We need to listen on document itself, since mouse can go outside of the\n    // window, and we will loose it\n\n    document.addEventListener('mousemove', onMouseMove);\n    document.addEventListener('mouseup', onMouseUp);\n    textSelection.capture(e.target || e.srcElement);\n    return false;\n  }\n\n  function onMouseMove(e) {\n    // no need to worry about mouse events when touch is happening\n    if (touchInProgress) return;\n    triggerPanStart();\n    var offset = getOffsetXY(e);\n    var point = transformToScreen(offset.x, offset.y);\n    var dx = point.x - mouseX;\n    var dy = point.y - mouseY;\n    mouseX = point.x;\n    mouseY = point.y;\n    internalMoveBy(dx, dy);\n  }\n\n  function onMouseUp() {\n    textSelection.release();\n    triggerPanEnd();\n    releaseDocumentMouse();\n  }\n\n  function releaseDocumentMouse() {\n    document.removeEventListener('mousemove', onMouseMove);\n    document.removeEventListener('mouseup', onMouseUp);\n    panstartFired = false;\n  }\n\n  function releaseTouches() {\n    document.removeEventListener('touchmove', handleTouchMove);\n    document.removeEventListener('touchend', handleTouchEnd);\n    document.removeEventListener('touchcancel', handleTouchEnd);\n    panstartFired = false;\n    multiTouch = false;\n    touchInProgress = false;\n  }\n\n  function onMouseWheel(e) {\n    // if client does not want to handle this event - just ignore the call\n    if (beforeWheel(e)) return;\n    smoothScroll.cancel();\n    var delta = e.deltaY;\n    if (e.deltaMode > 0) delta *= 100;\n    var scaleMultiplier = getScaleMultiplier(delta);\n\n    if (scaleMultiplier !== 1) {\n      var offset = transformOrigin ? getTransformOriginOffset() : getOffsetXY(e);\n      publicZoomTo(offset.x, offset.y, scaleMultiplier);\n      e.preventDefault();\n    }\n  }\n\n  function getOffsetXY(e) {\n    var offsetX, offsetY; // I tried using e.offsetX, but that gives wrong results for svg, when user clicks on a path.\n\n    var ownerRect = owner.getBoundingClientRect();\n    offsetX = e.clientX - ownerRect.left;\n    offsetY = e.clientY - ownerRect.top;\n    return {\n      x: offsetX,\n      y: offsetY\n    };\n  }\n\n  function smoothZoom(clientX, clientY, scaleMultiplier) {\n    var fromValue = transform.scale;\n    var from = {\n      scale: fromValue\n    };\n    var to = {\n      scale: scaleMultiplier * fromValue\n    };\n    smoothScroll.cancel();\n    cancelZoomAnimation();\n    zoomToAnimation = animate(from, to, {\n      step: function (v) {\n        zoomAbs(clientX, clientY, v.scale);\n      },\n      done: triggerZoomEnd\n    });\n  }\n\n  function smoothZoomAbs(clientX, clientY, toScaleValue) {\n    var fromValue = transform.scale;\n    var from = {\n      scale: fromValue\n    };\n    var to = {\n      scale: toScaleValue\n    };\n    smoothScroll.cancel();\n    cancelZoomAnimation();\n    zoomToAnimation = animate(from, to, {\n      step: function (v) {\n        zoomAbs(clientX, clientY, v.scale);\n      }\n    });\n  }\n\n  function getTransformOriginOffset() {\n    var ownerRect = owner.getBoundingClientRect();\n    return {\n      x: ownerRect.width * transformOrigin.x,\n      y: ownerRect.height * transformOrigin.y\n    };\n  }\n\n  function publicZoomTo(clientX, clientY, scaleMultiplier) {\n    smoothScroll.cancel();\n    cancelZoomAnimation();\n    return zoomByRatio(clientX, clientY, scaleMultiplier);\n  }\n\n  function cancelZoomAnimation() {\n    if (zoomToAnimation) {\n      zoomToAnimation.cancel();\n      zoomToAnimation = null;\n    }\n  }\n\n  function getScaleMultiplier(delta) {\n    var sign = Math.sign(delta);\n    var deltaAdjustedSpeed = Math.min(0.25, Math.abs(speed * delta / 128));\n    return 1 - sign * deltaAdjustedSpeed;\n  }\n\n  function triggerPanStart() {\n    if (!panstartFired) {\n      triggerEvent('panstart');\n      panstartFired = true;\n      smoothScroll.start();\n    }\n  }\n\n  function triggerPanEnd() {\n    if (panstartFired) {\n      // we should never run smooth scrolling if it was multiTouch (pinch zoom animation):\n      if (!multiTouch) smoothScroll.stop();\n      triggerEvent('panend');\n    }\n  }\n\n  function triggerZoomEnd() {\n    triggerEvent('zoomend');\n  }\n\n  function triggerEvent(name) {\n    api.fire(name, api);\n  }\n}\n\nfunction parseTransformOrigin(options) {\n  if (!options) return;\n\n  if (typeof options === 'object') {\n    if (!isNumber(options.x) || !isNumber(options.y)) failTransformOrigin(options);\n    return options;\n  }\n\n  failTransformOrigin();\n}\n\nfunction failTransformOrigin(options) {\n  console.error(options);\n  throw new Error(['Cannot parse transform origin.', 'Some good examples:', '  \"center center\" can be achieved with {x: 0.5, y: 0.5}', '  \"top center\" can be achieved with {x: 0.5, y: 0}', '  \"bottom right\" can be achieved with {x: 1, y: 1}'].join('\\n'));\n}\n\nfunction noop() {}\n\nfunction validateBounds(bounds) {\n  var boundsType = typeof bounds;\n  if (boundsType === 'undefined' || boundsType === 'boolean') return; // this is okay\n  // otherwise need to be more thorough:\n\n  var validBounds = isNumber(bounds.left) && isNumber(bounds.top) && isNumber(bounds.bottom) && isNumber(bounds.right);\n  if (!validBounds) throw new Error('Bounds object is not valid. It can be: ' + 'undefined, boolean (true|false) or an object {left, top, right, bottom}');\n}\n\nfunction isNumber(x) {\n  return Number.isFinite(x);\n} // IE 11 does not support isNaN:\n\n\nfunction isNaN(value) {\n  if (Number.isNaN) {\n    return Number.isNaN(value);\n  }\n\n  return value !== value;\n}\n\nfunction rigidScroll() {\n  return {\n    start: noop,\n    stop: noop,\n    cancel: noop\n  };\n}\n\nfunction autoRun() {\n  if (typeof document === 'undefined') return;\n  var scripts = document.getElementsByTagName('script');\n  if (!scripts) return;\n  var panzoomScript;\n\n  for (var i = 0; i < scripts.length; ++i) {\n    var x = scripts[i];\n\n    if (x.src && x.src.match(/\\bpanzoom(\\.min)?\\.js/)) {\n      panzoomScript = x;\n      break;\n    }\n  }\n\n  if (!panzoomScript) return;\n  var query = panzoomScript.getAttribute('query');\n  if (!query) return;\n  var globalName = panzoomScript.getAttribute('name') || 'pz';\n  var started = Date.now();\n  tryAttach();\n\n  function tryAttach() {\n    var el = document.querySelector(query);\n\n    if (!el) {\n      var now = Date.now();\n      var elapsed = now - started;\n\n      if (elapsed < 2000) {\n        // Let's wait a bit\n        setTimeout(tryAttach, 100);\n        return;\n      } // If we don't attach within 2 seconds to the target element, consider it a failure\n\n\n      console.error('Cannot find the panzoom element', globalName);\n      return;\n    }\n\n    var options = collectOptions(panzoomScript);\n    console.log(options);\n    window[globalName] = createPanZoom(el, options);\n  }\n\n  function collectOptions(script) {\n    var attrs = script.attributes;\n    var options = {};\n\n    for (var j = 0; j < attrs.length; ++j) {\n      var attr = attrs[j];\n      var nameValue = getPanzoomAttributeNameValue(attr);\n\n      if (nameValue) {\n        options[nameValue.name] = nameValue.value;\n      }\n    }\n\n    return options;\n  }\n\n  function getPanzoomAttributeNameValue(attr) {\n    if (!attr.name) return;\n    var isPanZoomAttribute = attr.name[0] === 'p' && attr.name[1] === 'z' && attr.name[2] === '-';\n    if (!isPanZoomAttribute) return;\n    var name = attr.name.substr(3);\n    var value = JSON.parse(attr.value);\n    return {\n      name: name,\n      value: value\n    };\n  }\n}\n\nautoRun();","map":{"version":3,"sources":["D:/Stage/App/xr-place-application/client/node_modules/panzoom/index.js"],"names":["wheel","require","animate","eventify","kinetic","createTextSelectionInterceptor","domTextSelectionInterceptor","fakeTextSelectorInterceptor","Transform","makeSvgController","makeDomController","defaultZoomSpeed","defaultDoubleTapZoomSpeed","doubleTapSpeedInMS","module","exports","createPanZoom","domElement","options","panController","controller","canAttach","Error","owner","getOwner","storedCTMResult","x","y","isDirty","transform","initTransform","filterKey","noop","pinchSpeed","bounds","maxZoom","Number","POSITIVE_INFINITY","minZoom","boundsPadding","zoomDoubleClickSpeed","beforeWheel","beforeMouseDown","speed","zoomSpeed","transformOrigin","parseTransformOrigin","textSelection","enableTextSelection","validateBounds","autocenter","frameAnimation","lastTouchEndTime","lastSingleFingerOffset","touchInProgress","panstartFired","mouseX","mouseY","pinchZoomLength","smoothScroll","rigidScroll","getPoint","scroll","moveByAnimation","zoomToAnimation","multiTouch","paused","listenForEvents","api","dispose","moveBy","internalMoveBy","moveTo","smoothMoveTo","centerOn","zoomTo","publicZoomTo","zoomAbs","smoothZoom","smoothZoomAbs","showRectangle","pause","resume","isPaused","getTransform","getTransformModel","getMinZoom","setMinZoom","getMaxZoom","setMaxZoom","getTransformOrigin","setTransformOrigin","getZoomSpeed","setZoomSpeed","initialX","initialY","initialZoom","scale","releaseEvents","rect","clientRect","getBoundingClientRect","size","transformToScreen","width","height","rectWidth","right","left","rectHeight","bottom","top","isFinite","dw","dh","Math","min","getScreenCTM","parentCTM","parentScaleX","a","parentScaleY","d","parentOffsetX","e","parentOffsetY","f","w","h","sceneBoundingBox","getBoundingBox","ownerRect","bbox","getBBox","newMinZoom","newMaxZoom","newTransformOrigin","newSpeed","keepTransformInsideBounds","triggerEvent","makeDirty","dx","dy","boundingBox","adjusted","getClientRect","diff","sceneWidth","sceneHeight","leftTop","client","window","requestAnimationFrame","frame","zoomByRatio","clientX","clientY","ratio","isNaN","newScale","transformAdjusted","zoomLevel","ui","parent","ownerSVGElement","cx","cy","container","smooth","cancel","from","to","lastX","lastY","step","v","cancelZoomAnimation","addEventListener","onMouseDown","passive","onDoubleClick","onTouch","onKeyDown","addWheelListener","onMouseWheel","removeWheelListener","removeEventListener","cancelAnimationFrame","releaseDocumentMouse","releaseTouches","release","triggerPanEnd","applyTransform","z","keyCode","preventDefault","stopPropagation","offset","moveSpeedRatio","scaleMultiplier","getScaleMultiplier","getTransformOriginOffset","midPoint","beforeTouch","touches","length","handleSingleFingerTouch","getPinchZoomLength","startTouchListenerIfNeeded","beforeDoubleClick","touch","getOffsetXY","point","document","handleTouchMove","handleTouchEnd","triggerPanStart","t1","t2","currentPinchLength","firstTouchPoint","secondTouchPoint","now","Date","finger1","finger2","sqrt","isLeftButton","button","event","onMouseMove","onMouseUp","capture","target","srcElement","delta","deltaY","deltaMode","offsetX","offsetY","fromValue","done","triggerZoomEnd","toScaleValue","sign","deltaAdjustedSpeed","abs","start","stop","name","fire","isNumber","failTransformOrigin","console","error","join","boundsType","validBounds","value","autoRun","scripts","getElementsByTagName","panzoomScript","i","src","match","query","getAttribute","globalName","started","tryAttach","el","querySelector","elapsed","setTimeout","collectOptions","log","script","attrs","attributes","j","attr","nameValue","getPanzoomAttributeNameValue","isPanZoomAttribute","substr","JSON","parse"],"mappings":"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","sourcesContent":["'use strict';\n/**\n * Allows to drag and zoom svg elements\n */\nvar wheel = require('wheel');\nvar animate = require('amator');\nvar eventify = require('ngraph.events');\nvar kinetic = require('./lib/kinetic.js');\nvar createTextSelectionInterceptor = require('./lib/createTextSelectionInterceptor.js');\nvar domTextSelectionInterceptor = createTextSelectionInterceptor();\nvar fakeTextSelectorInterceptor = createTextSelectionInterceptor(true);\nvar Transform = require('./lib/transform.js');\nvar makeSvgController = require('./lib/svgController.js');\nvar makeDomController = require('./lib/domController.js');\n\nvar defaultZoomSpeed = 1;\nvar defaultDoubleTapZoomSpeed = 1.75;\nvar doubleTapSpeedInMS = 300;\n\nmodule.exports = createPanZoom;\n\n/**\n * Creates a new instance of panzoom, so that an object can be panned and zoomed\n *\n * @param {DOMElement} domElement where panzoom should be attached.\n * @param {Object} options that configure behavior.\n */\nfunction createPanZoom(domElement, options) {\n  options = options || {};\n\n  var panController = options.controller;\n\n  if (!panController) {\n    if (makeSvgController.canAttach(domElement)) {\n      panController = makeSvgController(domElement, options);\n    } else if (makeDomController.canAttach(domElement)) {\n      panController = makeDomController(domElement, options);\n    }\n  }\n\n  if (!panController) {\n    throw new Error(\n      'Cannot create panzoom for the current type of dom element'\n    );\n  }\n  var owner = panController.getOwner();\n  // just to avoid GC pressure, every time we do intermediate transform\n  // we return this object. For internal use only. Never give it back to the consumer of this library\n  var storedCTMResult = { x: 0, y: 0 };\n\n  var isDirty = false;\n  var transform = new Transform();\n\n  if (panController.initTransform) {\n    panController.initTransform(transform);\n  }\n\n  var filterKey = typeof options.filterKey === 'function' ? options.filterKey : noop;\n  // TODO: likely need to unite pinchSpeed with zoomSpeed\n  var pinchSpeed = typeof options.pinchSpeed === 'number' ? options.pinchSpeed : 1;\n  var bounds = options.bounds;\n  var maxZoom = typeof options.maxZoom === 'number' ? options.maxZoom : Number.POSITIVE_INFINITY;\n  var minZoom = typeof options.minZoom === 'number' ? options.minZoom : 0;\n\n  var boundsPadding = typeof options.boundsPadding === 'number' ? options.boundsPadding : 0.05;\n  var zoomDoubleClickSpeed = typeof options.zoomDoubleClickSpeed === 'number' ? options.zoomDoubleClickSpeed : defaultDoubleTapZoomSpeed;\n  var beforeWheel = options.beforeWheel || noop;\n  var beforeMouseDown = options.beforeMouseDown || noop;\n  var speed = typeof options.zoomSpeed === 'number' ? options.zoomSpeed : defaultZoomSpeed;\n  var transformOrigin = parseTransformOrigin(options.transformOrigin);\n  var textSelection = options.enableTextSelection ? fakeTextSelectorInterceptor : domTextSelectionInterceptor;\n\n  validateBounds(bounds);\n\n  if (options.autocenter) {\n    autocenter();\n  }\n\n  var frameAnimation;\n  var lastTouchEndTime = 0;\n  var lastSingleFingerOffset;\n  var touchInProgress = false;\n\n  // We only need to fire panstart when actual move happens\n  var panstartFired = false;\n\n  // cache mouse coordinates here\n  var mouseX;\n  var mouseY;\n\n  var pinchZoomLength;\n\n  var smoothScroll;\n  if ('smoothScroll' in options && !options.smoothScroll) {\n    // If user explicitly asked us not to use smooth scrolling, we obey\n    smoothScroll = rigidScroll();\n  } else {\n    // otherwise we use forward smoothScroll settings to kinetic API\n    // which makes scroll smoothing.\n    smoothScroll = kinetic(getPoint, scroll, options.smoothScroll);\n  }\n\n  var moveByAnimation;\n  var zoomToAnimation;\n\n  var multiTouch;\n  var paused = false;\n\n  listenForEvents();\n\n  var api = {\n    dispose: dispose,\n    moveBy: internalMoveBy,\n    moveTo: moveTo,\n    smoothMoveTo: smoothMoveTo, \n    centerOn: centerOn,\n    zoomTo: publicZoomTo,\n    zoomAbs: zoomAbs,\n    smoothZoom: smoothZoom,\n    smoothZoomAbs: smoothZoomAbs,\n    showRectangle: showRectangle,\n\n    pause: pause,\n    resume: resume,\n    isPaused: isPaused,\n\n    getTransform: getTransformModel,\n\n    getMinZoom: getMinZoom,\n    setMinZoom: setMinZoom,\n\n    getMaxZoom: getMaxZoom,\n    setMaxZoom: setMaxZoom,\n\n    getTransformOrigin: getTransformOrigin,\n    setTransformOrigin: setTransformOrigin,\n\n    getZoomSpeed: getZoomSpeed,\n    setZoomSpeed: setZoomSpeed\n  };\n\n  eventify(api);\n  \n  var initialX = typeof options.initialX === 'number' ? options.initialX : transform.x;\n  var initialY = typeof options.initialY === 'number' ? options.initialY : transform.y;\n  var initialZoom = typeof options.initialZoom === 'number' ? options.initialZoom : transform.scale;\n\n  if(initialX != transform.x || initialY != transform.y || initialZoom != transform.scale){\n    zoomAbs(initialX, initialY, initialZoom);\n  }\n\n  return api;\n\n  function pause() {\n    releaseEvents();\n    paused = true;\n  }\n\n  function resume() {\n    if (paused) {\n      listenForEvents();\n      paused = false;\n    }\n  }\n\n  function isPaused() {\n    return paused;\n  }\n\n  function showRectangle(rect) {\n    // TODO: this duplicates autocenter. I think autocenter should go.\n    var clientRect = owner.getBoundingClientRect();\n    var size = transformToScreen(clientRect.width, clientRect.height);\n\n    var rectWidth = rect.right - rect.left;\n    var rectHeight = rect.bottom - rect.top;\n    if (!Number.isFinite(rectWidth) || !Number.isFinite(rectHeight)) {\n      throw new Error('Invalid rectangle');\n    }\n\n    var dw = size.x / rectWidth;\n    var dh = size.y / rectHeight;\n    var scale = Math.min(dw, dh);\n    transform.x = -(rect.left + rectWidth / 2) * scale + size.x / 2;\n    transform.y = -(rect.top + rectHeight / 2) * scale + size.y / 2;\n    transform.scale = scale;\n  }\n\n  function transformToScreen(x, y) {\n    if (panController.getScreenCTM) {\n      var parentCTM = panController.getScreenCTM();\n      var parentScaleX = parentCTM.a;\n      var parentScaleY = parentCTM.d;\n      var parentOffsetX = parentCTM.e;\n      var parentOffsetY = parentCTM.f;\n      storedCTMResult.x = x * parentScaleX - parentOffsetX;\n      storedCTMResult.y = y * parentScaleY - parentOffsetY;\n    } else {\n      storedCTMResult.x = x;\n      storedCTMResult.y = y;\n    }\n\n    return storedCTMResult;\n  }\n\n  function autocenter() {\n    var w; // width of the parent\n    var h; // height of the parent\n    var left = 0;\n    var top = 0;\n    var sceneBoundingBox = getBoundingBox();\n    if (sceneBoundingBox) {\n      // If we have bounding box - use it.\n      left = sceneBoundingBox.left;\n      top = sceneBoundingBox.top;\n      w = sceneBoundingBox.right - sceneBoundingBox.left;\n      h = sceneBoundingBox.bottom - sceneBoundingBox.top;\n    } else {\n      // otherwise just use whatever space we have\n      var ownerRect = owner.getBoundingClientRect();\n      w = ownerRect.width;\n      h = ownerRect.height;\n    }\n    var bbox = panController.getBBox();\n    if (bbox.width === 0 || bbox.height === 0) {\n      // we probably do not have any elements in the SVG\n      // just bail out;\n      return;\n    }\n    var dh = h / bbox.height;\n    var dw = w / bbox.width;\n    var scale = Math.min(dw, dh);\n    transform.x = -(bbox.left + bbox.width / 2) * scale + w / 2 + left;\n    transform.y = -(bbox.top + bbox.height / 2) * scale + h / 2 + top;\n    transform.scale = scale;\n  }\n\n  function getTransformModel() {\n    // TODO: should this be read only?\n    return transform;\n  }\n\n  function getMinZoom() {\n    return minZoom;\n  }\n\n  function setMinZoom(newMinZoom) {\n    minZoom = newMinZoom;\n  }\n\n  function getMaxZoom() {\n    return maxZoom;\n  }\n\n  function setMaxZoom(newMaxZoom) {\n    maxZoom = newMaxZoom;\n  }\n\n  function getTransformOrigin() {\n    return transformOrigin;\n  }\n\n  function setTransformOrigin(newTransformOrigin) {\n    transformOrigin = parseTransformOrigin(newTransformOrigin);\n  }\n\n  function getZoomSpeed() {\n    return speed;\n  }\n\n  function setZoomSpeed(newSpeed) {\n    if (!Number.isFinite(newSpeed)) {\n      throw new Error('Zoom speed should be a number');\n    }\n    speed = newSpeed;\n  }\n\n  function getPoint() {\n    return {\n      x: transform.x,\n      y: transform.y\n    };\n  }\n\n  function moveTo(x, y) {\n    transform.x = x;\n    transform.y = y;\n\n    keepTransformInsideBounds();\n\n    triggerEvent('pan');\n    makeDirty();\n  }\n\n  function moveBy(dx, dy) {\n    moveTo(transform.x + dx, transform.y + dy);\n  }\n\n  function keepTransformInsideBounds() {\n    var boundingBox = getBoundingBox();\n    if (!boundingBox) return;\n\n    var adjusted = false;\n    var clientRect = getClientRect();\n\n    var diff = boundingBox.left - clientRect.right;\n    if (diff > 0) {\n      transform.x += diff;\n      adjusted = true;\n    }\n    // check the other side:\n    diff = boundingBox.right - clientRect.left;\n    if (diff < 0) {\n      transform.x += diff;\n      adjusted = true;\n    }\n\n    // y axis:\n    diff = boundingBox.top - clientRect.bottom;\n    if (diff > 0) {\n      // we adjust transform, so that it matches exactly our bounding box:\n      // transform.y = boundingBox.top - (boundingBox.height + boundingBox.y) * transform.scale =>\n      // transform.y = boundingBox.top - (clientRect.bottom - transform.y) =>\n      // transform.y = diff + transform.y =>\n      transform.y += diff;\n      adjusted = true;\n    }\n\n    diff = boundingBox.bottom - clientRect.top;\n    if (diff < 0) {\n      transform.y += diff;\n      adjusted = true;\n    }\n    return adjusted;\n  }\n\n  /**\n   * Returns bounding box that should be used to restrict scene movement.\n   */\n  function getBoundingBox() {\n    if (!bounds) return; // client does not want to restrict movement\n\n    if (typeof bounds === 'boolean') {\n      // for boolean type we use parent container bounds\n      var ownerRect = owner.getBoundingClientRect();\n      var sceneWidth = ownerRect.width;\n      var sceneHeight = ownerRect.height;\n\n      return {\n        left: sceneWidth * boundsPadding,\n        top: sceneHeight * boundsPadding,\n        right: sceneWidth * (1 - boundsPadding),\n        bottom: sceneHeight * (1 - boundsPadding)\n      };\n    }\n\n    return bounds;\n  }\n\n  function getClientRect() {\n    var bbox = panController.getBBox();\n    var leftTop = client(bbox.left, bbox.top);\n\n    return {\n      left: leftTop.x,\n      top: leftTop.y,\n      right: bbox.width * transform.scale + leftTop.x,\n      bottom: bbox.height * transform.scale + leftTop.y\n    };\n  }\n\n  function client(x, y) {\n    return {\n      x: x * transform.scale + transform.x,\n      y: y * transform.scale + transform.y\n    };\n  }\n\n  function makeDirty() {\n    isDirty = true;\n    frameAnimation = window.requestAnimationFrame(frame);\n  }\n\n  function zoomByRatio(clientX, clientY, ratio) {\n    if (isNaN(clientX) || isNaN(clientY) || isNaN(ratio)) {\n      throw new Error('zoom requires valid numbers');\n    }\n\n    var newScale = transform.scale * ratio;\n\n    if (newScale < minZoom) {\n      if (transform.scale === minZoom) return;\n\n      ratio = minZoom / transform.scale;\n    }\n    if (newScale > maxZoom) {\n      if (transform.scale === maxZoom) return;\n\n      ratio = maxZoom / transform.scale;\n    }\n\n    var size = transformToScreen(clientX, clientY);\n\n    transform.x = size.x - ratio * (size.x - transform.x);\n    transform.y = size.y - ratio * (size.y - transform.y);\n\n    // TODO: https://github.com/anvaka/panzoom/issues/112\n    if (bounds && boundsPadding === 1 && minZoom === 1) {\n      transform.scale *= ratio;\n      keepTransformInsideBounds();\n    } else {\n      var transformAdjusted = keepTransformInsideBounds();\n      if (!transformAdjusted) transform.scale *= ratio;\n    }\n\n    triggerEvent('zoom');\n\n    makeDirty();\n  }\n\n  function zoomAbs(clientX, clientY, zoomLevel) {\n    var ratio = zoomLevel / transform.scale;\n    zoomByRatio(clientX, clientY, ratio);\n  }\n\n  function centerOn(ui) {\n    var parent = ui.ownerSVGElement;\n    if (!parent)\n      throw new Error('ui element is required to be within the scene');\n\n    // TODO: should i use controller's screen CTM?\n    var clientRect = ui.getBoundingClientRect();\n    var cx = clientRect.left + clientRect.width / 2;\n    var cy = clientRect.top + clientRect.height / 2;\n\n    var container = parent.getBoundingClientRect();\n    var dx = container.width / 2 - cx;\n    var dy = container.height / 2 - cy;\n\n    internalMoveBy(dx, dy, true);\n  }\n\n  function smoothMoveTo(x, y){\n    internalMoveBy(x - transform.x, y - transform.y, true);\n  }\n\n  function internalMoveBy(dx, dy, smooth) {\n    if (!smooth) {\n      return moveBy(dx, dy);\n    }\n\n    if (moveByAnimation) moveByAnimation.cancel();\n\n    var from = { x: 0, y: 0 };\n    var to = { x: dx, y: dy };\n    var lastX = 0;\n    var lastY = 0;\n\n    moveByAnimation = animate(from, to, {\n      step: function (v) {\n        moveBy(v.x - lastX, v.y - lastY);\n\n        lastX = v.x;\n        lastY = v.y;\n      }\n    });\n  }\n\n  function scroll(x, y) {\n    cancelZoomAnimation();\n    moveTo(x, y);\n  }\n\n  function dispose() {\n    releaseEvents();\n  }\n\n  function listenForEvents() {\n    owner.addEventListener('mousedown', onMouseDown, { passive: false });\n    owner.addEventListener('dblclick', onDoubleClick, { passive: false });\n    owner.addEventListener('touchstart', onTouch, { passive: false });\n    owner.addEventListener('keydown', onKeyDown, { passive: false });\n\n    // Need to listen on the owner container, so that we are not limited\n    // by the size of the scrollable domElement\n    wheel.addWheelListener(owner, onMouseWheel, { passive: false });\n\n    makeDirty();\n  }\n\n  function releaseEvents() {\n    wheel.removeWheelListener(owner, onMouseWheel);\n    owner.removeEventListener('mousedown', onMouseDown);\n    owner.removeEventListener('keydown', onKeyDown);\n    owner.removeEventListener('dblclick', onDoubleClick);\n    owner.removeEventListener('touchstart', onTouch);\n\n    if (frameAnimation) {\n      window.cancelAnimationFrame(frameAnimation);\n      frameAnimation = 0;\n    }\n\n    smoothScroll.cancel();\n\n    releaseDocumentMouse();\n    releaseTouches();\n    textSelection.release();\n\n    triggerPanEnd();\n  }\n\n  function frame() {\n    if (isDirty) applyTransform();\n  }\n\n  function applyTransform() {\n    isDirty = false;\n\n    // TODO: Should I allow to cancel this?\n    panController.applyTransform(transform);\n\n    triggerEvent('transform');\n    frameAnimation = 0;\n  }\n\n  function onKeyDown(e) {\n    var x = 0,\n      y = 0,\n      z = 0;\n    if (e.keyCode === 38) {\n      y = 1; // up\n    } else if (e.keyCode === 40) {\n      y = -1; // down\n    } else if (e.keyCode === 37) {\n      x = 1; // left\n    } else if (e.keyCode === 39) {\n      x = -1; // right\n    } else if (e.keyCode === 189 || e.keyCode === 109) {\n      // DASH or SUBTRACT\n      z = 1; // `-` -  zoom out\n    } else if (e.keyCode === 187 || e.keyCode === 107) {\n      // EQUAL SIGN or ADD\n      z = -1; // `=` - zoom in (equal sign on US layout is under `+`)\n    }\n\n    if (filterKey(e, x, y, z)) {\n      // They don't want us to handle the key: https://github.com/anvaka/panzoom/issues/45\n      return;\n    }\n\n    if (x || y) {\n      e.preventDefault();\n      e.stopPropagation();\n\n      var clientRect = owner.getBoundingClientRect();\n      // movement speed should be the same in both X and Y direction:\n      var offset = Math.min(clientRect.width, clientRect.height);\n      var moveSpeedRatio = 0.05;\n      var dx = offset * moveSpeedRatio * x;\n      var dy = offset * moveSpeedRatio * y;\n\n      // TODO: currently we do not animate this. It could be better to have animation\n      internalMoveBy(dx, dy);\n    }\n\n    if (z) {\n      var scaleMultiplier = getScaleMultiplier(z * 100);\n      var offset = transformOrigin ? getTransformOriginOffset() : midPoint();\n      publicZoomTo(offset.x, offset.y, scaleMultiplier);\n    }\n  }\n\n  function midPoint() {\n    var ownerRect = owner.getBoundingClientRect();\n    return {\n      x: ownerRect.width / 2,\n      y: ownerRect.height / 2\n    };\n  }\n\n  function onTouch(e) {\n    // let the override the touch behavior\n    beforeTouch(e);\n\n    if (e.touches.length === 1) {\n      return handleSingleFingerTouch(e, e.touches[0]);\n    } else if (e.touches.length === 2) {\n      // handleTouchMove() will care about pinch zoom.\n      pinchZoomLength = getPinchZoomLength(e.touches[0], e.touches[1]);\n      multiTouch = true;\n      startTouchListenerIfNeeded();\n    }\n  }\n\n  function beforeTouch(e) {\n    // TODO: Need to unify this filtering names. E.g. use `beforeTouch`\n    if (options.onTouch && !options.onTouch(e)) {\n      // if they return `false` from onTouch, we don't want to stop\n      // events propagation. Fixes https://github.com/anvaka/panzoom/issues/12\n      return;\n    }\n\n    e.stopPropagation();\n    e.preventDefault();\n  }\n\n  function beforeDoubleClick(e) {\n    // TODO: Need to unify this filtering names. E.g. use `beforeDoubleClick``\n    if (options.onDoubleClick && !options.onDoubleClick(e)) {\n      // if they return `false` from onTouch, we don't want to stop\n      // events propagation. Fixes https://github.com/anvaka/panzoom/issues/46\n      return;\n    }\n\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  function handleSingleFingerTouch(e) {\n    var touch = e.touches[0];\n    var offset = getOffsetXY(touch);\n    lastSingleFingerOffset = offset;\n    var point = transformToScreen(offset.x, offset.y);\n    mouseX = point.x;\n    mouseY = point.y;\n\n    smoothScroll.cancel();\n    startTouchListenerIfNeeded();\n  }\n\n  function startTouchListenerIfNeeded() {\n    if (touchInProgress) {\n      // no need to do anything, as we already listen to events;\n      return;\n    }\n\n    touchInProgress = true;\n    document.addEventListener('touchmove', handleTouchMove);\n    document.addEventListener('touchend', handleTouchEnd);\n    document.addEventListener('touchcancel', handleTouchEnd);\n  }\n\n  function handleTouchMove(e) {\n    if (e.touches.length === 1) {\n      e.stopPropagation();\n      var touch = e.touches[0];\n\n      var offset = getOffsetXY(touch);\n      var point = transformToScreen(offset.x, offset.y);\n\n      var dx = point.x - mouseX;\n      var dy = point.y - mouseY;\n\n      if (dx !== 0 && dy !== 0) {\n        triggerPanStart();\n      }\n      mouseX = point.x;\n      mouseY = point.y;\n      internalMoveBy(dx, dy);\n    } else if (e.touches.length === 2) {\n      // it's a zoom, let's find direction\n      multiTouch = true;\n      var t1 = e.touches[0];\n      var t2 = e.touches[1];\n      var currentPinchLength = getPinchZoomLength(t1, t2);\n\n      // since the zoom speed is always based on distance from 1, we need to apply\n      // pinch speed only on that distance from 1:\n      var scaleMultiplier =\n        1 + (currentPinchLength / pinchZoomLength - 1) * pinchSpeed;\n\n      var firstTouchPoint = getOffsetXY(t1);\n      var secondTouchPoint = getOffsetXY(t2);\n      mouseX = (firstTouchPoint.x + secondTouchPoint.x) / 2;\n      mouseY = (firstTouchPoint.y + secondTouchPoint.y) / 2;\n      if (transformOrigin) {\n        var offset = getTransformOriginOffset();\n        mouseX = offset.x;\n        mouseY = offset.y;\n      }\n\n      publicZoomTo(mouseX, mouseY, scaleMultiplier);\n\n      pinchZoomLength = currentPinchLength;\n      e.stopPropagation();\n      e.preventDefault();\n    }\n  }\n\n  function handleTouchEnd(e) {\n    if (e.touches.length > 0) {\n      var offset = getOffsetXY(e.touches[0]);\n      var point = transformToScreen(offset.x, offset.y);\n      mouseX = point.x;\n      mouseY = point.y;\n    } else {\n      var now = new Date();\n      if (now - lastTouchEndTime < doubleTapSpeedInMS) {\n        if (transformOrigin) {\n          var offset = getTransformOriginOffset();\n          smoothZoom(offset.x, offset.y, zoomDoubleClickSpeed);\n        } else {\n          // We want untransformed x/y here.\n          smoothZoom(lastSingleFingerOffset.x, lastSingleFingerOffset.y, zoomDoubleClickSpeed);\n        }\n      }\n\n      lastTouchEndTime = now;\n\n      triggerPanEnd();\n      releaseTouches();\n    }\n  }\n\n  function getPinchZoomLength(finger1, finger2) {\n    var dx = finger1.clientX - finger2.clientX;\n    var dy = finger1.clientY - finger2.clientY;\n    return Math.sqrt(dx * dx + dy * dy);\n  }\n\n  function onDoubleClick(e) {\n    beforeDoubleClick(e);\n    var offset = getOffsetXY(e);\n    if (transformOrigin) {\n      // TODO: looks like this is duplicated in the file.\n      // Need to refactor\n      offset = getTransformOriginOffset();\n    }\n    smoothZoom(offset.x, offset.y, zoomDoubleClickSpeed);\n  }\n\n  function onMouseDown(e) {\n    // if client does not want to handle this event - just ignore the call\n    if (beforeMouseDown(e)) return;\n\n    if (touchInProgress) {\n      // modern browsers will fire mousedown for touch events too\n      // we do not want this: touch is handled separately.\n      e.stopPropagation();\n      return false;\n    }\n    // for IE, left click == 1\n    // for Firefox, left click == 0\n    var isLeftButton =\n      (e.button === 1 && window.event !== null) || e.button === 0;\n    if (!isLeftButton) return;\n\n    smoothScroll.cancel();\n\n    var offset = getOffsetXY(e);\n    var point = transformToScreen(offset.x, offset.y);\n    mouseX = point.x;\n    mouseY = point.y;\n\n    // We need to listen on document itself, since mouse can go outside of the\n    // window, and we will loose it\n    document.addEventListener('mousemove', onMouseMove);\n    document.addEventListener('mouseup', onMouseUp);\n    textSelection.capture(e.target || e.srcElement);\n\n    return false;\n  }\n\n  function onMouseMove(e) {\n    // no need to worry about mouse events when touch is happening\n    if (touchInProgress) return;\n\n    triggerPanStart();\n\n    var offset = getOffsetXY(e);\n    var point = transformToScreen(offset.x, offset.y);\n    var dx = point.x - mouseX;\n    var dy = point.y - mouseY;\n\n    mouseX = point.x;\n    mouseY = point.y;\n\n    internalMoveBy(dx, dy);\n  }\n\n  function onMouseUp() {\n    textSelection.release();\n    triggerPanEnd();\n    releaseDocumentMouse();\n  }\n\n  function releaseDocumentMouse() {\n    document.removeEventListener('mousemove', onMouseMove);\n    document.removeEventListener('mouseup', onMouseUp);\n    panstartFired = false;\n  }\n\n  function releaseTouches() {\n    document.removeEventListener('touchmove', handleTouchMove);\n    document.removeEventListener('touchend', handleTouchEnd);\n    document.removeEventListener('touchcancel', handleTouchEnd);\n    panstartFired = false;\n    multiTouch = false;\n    touchInProgress = false;\n  }\n\n  function onMouseWheel(e) {\n    // if client does not want to handle this event - just ignore the call\n    if (beforeWheel(e)) return;\n\n    smoothScroll.cancel();\n\n    var delta = e.deltaY;\n    if (e.deltaMode > 0) delta *= 100;\n\n    var scaleMultiplier = getScaleMultiplier(delta);\n\n    if (scaleMultiplier !== 1) {\n      var offset = transformOrigin\n        ? getTransformOriginOffset()\n        : getOffsetXY(e);\n      publicZoomTo(offset.x, offset.y, scaleMultiplier);\n      e.preventDefault();\n    }\n  }\n\n  function getOffsetXY(e) {\n    var offsetX, offsetY;\n    // I tried using e.offsetX, but that gives wrong results for svg, when user clicks on a path.\n    var ownerRect = owner.getBoundingClientRect();\n    offsetX = e.clientX - ownerRect.left;\n    offsetY = e.clientY - ownerRect.top;\n\n    return { x: offsetX, y: offsetY };\n  }\n\n  function smoothZoom(clientX, clientY, scaleMultiplier) {\n    var fromValue = transform.scale;\n    var from = { scale: fromValue };\n    var to = { scale: scaleMultiplier * fromValue };\n\n    smoothScroll.cancel();\n    cancelZoomAnimation();\n\n    zoomToAnimation = animate(from, to, {\n      step: function (v) {\n        zoomAbs(clientX, clientY, v.scale);\n      },\n      done: triggerZoomEnd\n    });\n  }\n\n  function smoothZoomAbs(clientX, clientY, toScaleValue) {\n    var fromValue = transform.scale;\n    var from = { scale: fromValue };\n    var to = { scale: toScaleValue };\n\n    smoothScroll.cancel();\n    cancelZoomAnimation();\n\n    zoomToAnimation = animate(from, to, {\n      step: function (v) {\n        zoomAbs(clientX, clientY, v.scale);\n      }\n    });\n  }\n\n  function getTransformOriginOffset() {\n    var ownerRect = owner.getBoundingClientRect();\n    return {\n      x: ownerRect.width * transformOrigin.x,\n      y: ownerRect.height * transformOrigin.y\n    };\n  }\n\n  function publicZoomTo(clientX, clientY, scaleMultiplier) {\n    smoothScroll.cancel();\n    cancelZoomAnimation();\n    return zoomByRatio(clientX, clientY, scaleMultiplier);\n  }\n\n  function cancelZoomAnimation() {\n    if (zoomToAnimation) {\n      zoomToAnimation.cancel();\n      zoomToAnimation = null;\n    }\n  }\n\n  function getScaleMultiplier(delta) {\n    var sign = Math.sign(delta);\n    var deltaAdjustedSpeed = Math.min(0.25, Math.abs(speed * delta / 128));\n    return 1 - sign * deltaAdjustedSpeed;\n  }\n\n  function triggerPanStart() {\n    if (!panstartFired) {\n      triggerEvent('panstart');\n      panstartFired = true;\n      smoothScroll.start();\n    }\n  }\n\n  function triggerPanEnd() {\n    if (panstartFired) {\n      // we should never run smooth scrolling if it was multiTouch (pinch zoom animation):\n      if (!multiTouch) smoothScroll.stop();\n      triggerEvent('panend');\n    }\n  }\n\n  function triggerZoomEnd() {\n    triggerEvent('zoomend');\n  }\n\n  function triggerEvent(name) {\n    api.fire(name, api);\n  }\n}\n\nfunction parseTransformOrigin(options) {\n  if (!options) return;\n  if (typeof options === 'object') {\n    if (!isNumber(options.x) || !isNumber(options.y))\n      failTransformOrigin(options);\n    return options;\n  }\n\n  failTransformOrigin();\n}\n\nfunction failTransformOrigin(options) {\n  console.error(options);\n  throw new Error(\n    [\n      'Cannot parse transform origin.',\n      'Some good examples:',\n      '  \"center center\" can be achieved with {x: 0.5, y: 0.5}',\n      '  \"top center\" can be achieved with {x: 0.5, y: 0}',\n      '  \"bottom right\" can be achieved with {x: 1, y: 1}'\n    ].join('\\n')\n  );\n}\n\nfunction noop() { }\n\nfunction validateBounds(bounds) {\n  var boundsType = typeof bounds;\n  if (boundsType === 'undefined' || boundsType === 'boolean') return; // this is okay\n  // otherwise need to be more thorough:\n  var validBounds =\n    isNumber(bounds.left) &&\n    isNumber(bounds.top) &&\n    isNumber(bounds.bottom) &&\n    isNumber(bounds.right);\n\n  if (!validBounds)\n    throw new Error(\n      'Bounds object is not valid. It can be: ' +\n      'undefined, boolean (true|false) or an object {left, top, right, bottom}'\n    );\n}\n\nfunction isNumber(x) {\n  return Number.isFinite(x);\n}\n\n// IE 11 does not support isNaN:\nfunction isNaN(value) {\n  if (Number.isNaN) {\n    return Number.isNaN(value);\n  }\n\n  return value !== value;\n}\n\nfunction rigidScroll() {\n  return {\n    start: noop,\n    stop: noop,\n    cancel: noop\n  };\n}\n\nfunction autoRun() {\n  if (typeof document === 'undefined') return;\n\n  var scripts = document.getElementsByTagName('script');\n  if (!scripts) return;\n  var panzoomScript;\n\n  for (var i = 0; i < scripts.length; ++i) {\n    var x = scripts[i];\n    if (x.src && x.src.match(/\\bpanzoom(\\.min)?\\.js/)) {\n      panzoomScript = x;\n      break;\n    }\n  }\n\n  if (!panzoomScript) return;\n\n  var query = panzoomScript.getAttribute('query');\n  if (!query) return;\n\n  var globalName = panzoomScript.getAttribute('name') || 'pz';\n  var started = Date.now();\n\n  tryAttach();\n\n  function tryAttach() {\n    var el = document.querySelector(query);\n    if (!el) {\n      var now = Date.now();\n      var elapsed = now - started;\n      if (elapsed < 2000) {\n        // Let's wait a bit\n        setTimeout(tryAttach, 100);\n        return;\n      }\n      // If we don't attach within 2 seconds to the target element, consider it a failure\n      console.error('Cannot find the panzoom element', globalName);\n      return;\n    }\n    var options = collectOptions(panzoomScript);\n    console.log(options);\n    window[globalName] = createPanZoom(el, options);\n  }\n\n  function collectOptions(script) {\n    var attrs = script.attributes;\n    var options = {};\n    for (var j = 0; j < attrs.length; ++j) {\n      var attr = attrs[j];\n      var nameValue = getPanzoomAttributeNameValue(attr);\n      if (nameValue) {\n        options[nameValue.name] = nameValue.value;\n      }\n    }\n\n    return options;\n  }\n\n  function getPanzoomAttributeNameValue(attr) {\n    if (!attr.name) return;\n    var isPanZoomAttribute =\n      attr.name[0] === 'p' && attr.name[1] === 'z' && attr.name[2] === '-';\n\n    if (!isPanZoomAttribute) return;\n\n    var name = attr.name.substr(3);\n    var value = JSON.parse(attr.value);\n    return { name: name, value: value };\n  }\n}\n\nautoRun();\n\t"]},"metadata":{},"sourceType":"script"}