{"ast":null,"code":"import _typeof from \"D:/Stage/App/xr-place-application/client/node_modules/@babel/runtime/helpers/esm/typeof.js\";\nimport _objectSpread from \"D:/Stage/App/xr-place-application/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport \"core-js/modules/es.number.constructor.js\";\nimport \"core-js/modules/web.timers.js\";\nimport \"core-js/modules/es.string.ends-with.js\";\nimport \"core-js/modules/es.string.starts-with.js\";\nimport { withDirectives as _withDirectives, resolveDirective as _resolveDirective, createVNode as _createVNode } from \"vue\";\nimport \"./VImg.css\"; // Components\n\nimport { VResponsive } from \"../VResponsive/index.mjs\"; // Directives\n\nimport intersect from \"../../directives/intersect/index.mjs\"; // Composables\n\nimport { makeTransitionProps, MaybeTransition } from \"../../composables/transition.mjs\"; // Utilities\n\nimport { computed, h, nextTick, onBeforeMount, ref, vShow, watch, withDirectives } from 'vue';\nimport { convertToUnit, defineComponent, SUPPORTS_INTERSECTION, useRender } from \"../../util/index.mjs\"; // Types\n\nexport var VImg = defineComponent({\n  name: 'VImg',\n  directives: {\n    intersect: intersect\n  },\n  props: _objectSpread({\n    aspectRatio: [String, Number],\n    alt: String,\n    cover: Boolean,\n    eager: Boolean,\n    gradient: String,\n    lazySrc: String,\n    options: {\n      type: Object,\n      // For more information on types, navigate to:\n      // https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API\n      \"default\": function _default() {\n        return {\n          root: undefined,\n          rootMargin: undefined,\n          threshold: undefined\n        };\n      }\n    },\n    sizes: String,\n    src: {\n      type: [String, Object],\n      \"default\": ''\n    },\n    srcset: String,\n    width: [String, Number]\n  }, makeTransitionProps()),\n  emits: ['loadstart', 'load', 'error'],\n  setup: function setup(props, _ref) {\n    var emit = _ref.emit,\n        slots = _ref.slots;\n    var currentSrc = ref(''); // Set from srcset\n\n    var image = ref();\n    var state = ref(props.eager ? 'loading' : 'idle');\n    var naturalWidth = ref();\n    var naturalHeight = ref();\n    var normalisedSrc = computed(function () {\n      return props.src && _typeof(props.src) === 'object' ? {\n        src: props.src.src,\n        srcset: props.srcset || props.src.srcset,\n        lazySrc: props.lazySrc || props.src.lazySrc,\n        aspect: Number(props.aspectRatio || props.src.aspect)\n      } : {\n        src: props.src,\n        srcset: props.srcset,\n        lazySrc: props.lazySrc,\n        aspect: Number(props.aspectRatio || 0)\n      };\n    });\n    var aspectRatio = computed(function () {\n      return normalisedSrc.value.aspect || naturalWidth.value / naturalHeight.value || 0;\n    });\n    watch(function () {\n      return props.src;\n    }, function () {\n      init(state.value !== 'idle');\n    }); // TODO: getSrc when window width changes\n\n    onBeforeMount(function () {\n      return init();\n    });\n\n    function init(isIntersecting) {\n      if (props.eager && isIntersecting) return;\n      if (SUPPORTS_INTERSECTION && !isIntersecting && !props.eager) return;\n      state.value = 'loading';\n\n      if (normalisedSrc.value.lazySrc) {\n        var lazyImg = new Image();\n        lazyImg.src = normalisedSrc.value.lazySrc;\n        pollForSize(lazyImg, null);\n      }\n\n      if (!normalisedSrc.value.src) return;\n      nextTick(function () {\n        var _image$value, _image$value2;\n\n        emit('loadstart', ((_image$value = image.value) == null ? void 0 : _image$value.currentSrc) || normalisedSrc.value.src);\n\n        if ((_image$value2 = image.value) != null && _image$value2.complete) {\n          if (!image.value.naturalWidth) {\n            onError();\n          }\n\n          if (state.value === 'error') return;\n          if (!aspectRatio.value) pollForSize(image.value, null);\n          onLoad();\n        } else {\n          if (!aspectRatio.value) pollForSize(image.value);\n          getSrc();\n        }\n      });\n    }\n\n    function onLoad() {\n      var _image$value3;\n\n      getSrc();\n      state.value = 'loaded';\n      emit('load', ((_image$value3 = image.value) == null ? void 0 : _image$value3.currentSrc) || normalisedSrc.value.src);\n    }\n\n    function onError() {\n      var _image$value4;\n\n      state.value = 'error';\n      emit('error', ((_image$value4 = image.value) == null ? void 0 : _image$value4.currentSrc) || normalisedSrc.value.src);\n    }\n\n    function getSrc() {\n      var img = image.value;\n      if (img) currentSrc.value = img.currentSrc || img.src;\n    }\n\n    function pollForSize(img) {\n      var timeout = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 100;\n\n      var poll = function poll() {\n        var imgHeight = img.naturalHeight,\n            imgWidth = img.naturalWidth;\n\n        if (imgHeight || imgWidth) {\n          naturalWidth.value = imgWidth;\n          naturalHeight.value = imgHeight;\n        } else if (!img.complete && state.value === 'loading' && timeout != null) {\n          setTimeout(poll, timeout);\n        } else if (img.currentSrc.endsWith('.svg') || img.currentSrc.startsWith('data:image/svg+xml')) {\n          naturalWidth.value = 1;\n          naturalHeight.value = 1;\n        }\n      };\n\n      poll();\n    }\n\n    var containClasses = computed(function () {\n      return {\n        'v-img__img--cover': props.cover,\n        'v-img__img--contain': !props.cover\n      };\n    });\n\n    var __image = computed(function () {\n      var _slots$sources;\n\n      if (!normalisedSrc.value.src || state.value === 'idle') return;\n      var img = h('img', {\n        \"class\": ['v-img__img', containClasses.value],\n        src: normalisedSrc.value.src,\n        srcset: normalisedSrc.value.srcset,\n        sizes: props.sizes,\n        ref: image,\n        onLoad: onLoad,\n        onError: onError\n      });\n      var sources = (_slots$sources = slots.sources) == null ? void 0 : _slots$sources.call(slots);\n      return _createVNode(MaybeTransition, {\n        \"transition\": props.transition,\n        \"appear\": true\n      }, {\n        \"default\": function _default() {\n          return [withDirectives(sources ? _createVNode(\"picture\", {\n            \"class\": \"v-img__picture\"\n          }, [sources, img]) : img, [[vShow, state.value === 'loaded']])];\n        }\n      });\n    });\n\n    var __preloadImage = computed(function () {\n      return _createVNode(MaybeTransition, {\n        \"transition\": props.transition\n      }, {\n        \"default\": function _default() {\n          return [normalisedSrc.value.lazySrc && state.value !== 'loaded' && _createVNode(\"img\", {\n            \"class\": ['v-img__img', 'v-img__img--preload', containClasses.value],\n            \"src\": normalisedSrc.value.lazySrc,\n            \"alt\": \"\"\n          }, null)];\n        }\n      });\n    });\n\n    var __placeholder = computed(function () {\n      if (!slots.placeholder) return;\n      return _createVNode(MaybeTransition, {\n        \"transition\": props.transition,\n        \"appear\": true\n      }, {\n        \"default\": function _default() {\n          return [(state.value === 'loading' || state.value === 'error' && !slots.error) && _createVNode(\"div\", {\n            \"class\": \"v-img__placeholder\"\n          }, [slots.placeholder()])];\n        }\n      });\n    });\n\n    var __error = computed(function () {\n      if (!slots.error) return;\n      return _createVNode(MaybeTransition, {\n        \"transition\": props.transition,\n        \"appear\": true\n      }, {\n        \"default\": function _default() {\n          return [state.value === 'error' && _createVNode(\"div\", {\n            \"class\": \"v-img__error\"\n          }, [slots.error()])];\n        }\n      });\n    });\n\n    var __gradient = computed(function () {\n      if (!props.gradient) return;\n      return _createVNode(\"div\", {\n        \"class\": \"v-img__gradient\",\n        \"style\": {\n          backgroundImage: \"linear-gradient(\".concat(props.gradient, \")\")\n        }\n      }, null);\n    });\n\n    var isBooted = ref(false);\n    {\n      var stop = watch(aspectRatio, function (val) {\n        if (val) {\n          // Doesn't work with nextTick, idk why\n          requestAnimationFrame(function () {\n            requestAnimationFrame(function () {\n              isBooted.value = true;\n            });\n          });\n          stop();\n        }\n      });\n    }\n    useRender(function () {\n      return _withDirectives(_createVNode(VResponsive, {\n        \"class\": ['v-img', {\n          'v-img--booting': !isBooted.value\n        }],\n        \"style\": {\n          width: convertToUnit(props.width === 'auto' ? naturalWidth.value : props.width)\n        },\n        \"aspectRatio\": aspectRatio.value,\n        \"aria-label\": props.alt,\n        \"role\": props.alt ? 'img' : undefined\n      }, {\n        additional: function additional() {\n          return [__image.value, __preloadImage.value, __gradient.value, __placeholder.value, __error.value];\n        },\n        \"default\": slots[\"default\"]\n      }), [[_resolveDirective(\"intersect\"), {\n        handler: init,\n        options: props.options\n      }, null, {\n        once: true\n      }]]);\n    });\n    return {\n      currentSrc: currentSrc,\n      image: image,\n      state: state,\n      naturalWidth: naturalWidth,\n      naturalHeight: naturalHeight\n    };\n  }\n});","map":{"version":3,"mappings":";;;;;;;AAAA,oB,CAEA;;SACSA,mB,4BAET;;OACOC,e,wCAEP;;SACSC,qBAAqBC,uB,oCAE9B;;AACA,SACEC,QADF,EAEEC,CAFF,EAGEC,QAHF,EAIEC,aAJF,EAKEC,GALF,EAMEC,KANF,EAOEC,KAPF,EAQEC,cARF,QASO,KATP;SAWEC,eACAC,iBACAC,uBACAC,iB,wBAGF;;AAWA,OAAO,IAAMC,IAAI,GAAGH,eAAe,CAAC;AAClCI,MAAI,EAAE,MAD4B;AAGlCC,YAAU,EAAE;AAAEjB;AAAF,GAHsB;AAKlCkB,OAAK;AACHC,eAAW,EAAE,CAACC,MAAD,EAASC,MAAT,CADV;AAEHC,OAAG,EAAEF,MAFF;AAGHG,SAAK,EAAEC,OAHJ;AAIHC,SAAK,EAAED,OAJJ;AAKHE,YAAQ,EAAEN,MALP;AAMHO,WAAO,EAAEP,MANN;AAOHQ,WAAO,EAAE;AACPC,UAAI,EAAEC,MADC;AAEP;AACA;AACAC,iBAAS;AAAA,eAAO;AACdC,cAAI,EAAEC,SADQ;AAEdC,oBAAU,EAAED,SAFE;AAGdE,mBAAS,EAAEF;AAHG,SAAP;AAAA;AAJF,KAPN;AAiBHG,SAAK,EAAEhB,MAjBJ;AAkBHiB,OAAG,EAAE;AACHR,UAAI,EAAE,CAACT,MAAD,EAASU,MAAT,CADH;AAEHC,iBAAS;AAFN,KAlBF;AAsBHO,UAAM,EAAElB,MAtBL;AAuBHmB,SAAK,EAAE,CAACnB,MAAD,EAASC,MAAT;AAvBJ,KAyBApB,mBAAmB,EAzBnB,CAL6B;AAiClCuC,OAAK,EAAE,CAAC,WAAD,EAAc,MAAd,EAAsB,OAAtB,CAjC2B;AAmClCC,OAnCkC,iBAmC3BvB,KAnC2B,EAmC7BwB,IAnC6B,EAmCH;AAAA,QAAfC,IAAe,QAAfA,IAAe;AAAA,QAATC,KAAS,QAATA,KAAS;AAC7B,QAAMC,UAAU,GAAGtC,GAAG,CAAC,EAAD,CAAtB,CAD6B,CACF;;AAC3B,QAAMuC,KAAK,GAAGvC,GAAG,EAAjB;AACA,QAAMwC,KAAK,GAAGxC,GAAG,CAA0CW,KAAK,CAACO,KAANP,GAAc,SAAdA,GAA0B,MAApE,CAAjB;AACA,QAAM8B,YAAY,GAAGzC,GAAG,EAAxB;AACA,QAAM0C,aAAa,GAAG1C,GAAG,EAAzB;AAEA,QAAM2C,aAAa,GAAG/C,QAAQ,CAAY,YAAM;AAC9C,aAAOe,KAAK,CAACmB,GAANnB,IAAa,QAAOA,KAAK,CAACmB,GAAb,MAAqB,QAAlCnB,GACH;AACAmB,WAAG,EAAEnB,KAAK,CAACmB,GAANnB,CAAUmB,GADf;AAEAC,cAAM,EAAEpB,KAAK,CAACoB,MAANpB,IAAgBA,KAAK,CAACmB,GAANnB,CAAUoB,MAFlC;AAGAX,eAAO,EAAET,KAAK,CAACS,OAANT,IAAiBA,KAAK,CAACmB,GAANnB,CAAUS,OAHpC;AAIAwB,cAAM,EAAE9B,MAAM,CAACH,KAAK,CAACC,WAAND,IAAqBA,KAAK,CAACmB,GAANnB,CAAUiC,MAAhC;AAJd,OADGjC,GAMD;AACFmB,WAAG,EAAEnB,KAAK,CAACmB,GADT;AAEFC,cAAM,EAAEpB,KAAK,CAACoB,MAFZ;AAGFX,eAAO,EAAET,KAAK,CAACS,OAHb;AAIFwB,cAAM,EAAE9B,MAAM,CAACH,KAAK,CAACC,WAAND,IAAqB,CAAtB;AAJZ,OANN;AAD4B,MAA9B;AAcA,QAAMC,WAAW,GAAGhB,QAAQ,CAAC,YAAM;AACjC,aAAO+C,aAAa,CAACE,KAAdF,CAAoBC,MAApBD,IAA8BF,YAAY,CAACI,KAAbJ,GAAsBC,aAAa,CAACG,KAAlEF,IAA4E,CAAnF;AAD0B,MAA5B;AAIAzC,SAAK,CAAC;AAAA,aAAMS,KAAK,CAACmB,GAAZ;AAAA,KAAD,EAAkB,YAAM;AAC3BgB,UAAI,CAACN,KAAK,CAACK,KAANL,KAAgB,MAAjB,CAAJM;AADG,MAAL5C,CAzB6B,CA4B7B;;AAEAH,iBAAa,CAAC;AAAA,aAAM+C,IAAI,EAAV;AAAA,KAAD,CAAb/C;;AAEA,aAAS+C,IAAT,CAAeC,cAAf,EAAyC;AACvC,UAAIpC,KAAK,CAACO,KAANP,IAAeoC,cAAnB,EAAmC;AACnC,UACEzC,qBAAqB,IACrB,CAACyC,cADDzC,IAEA,CAACK,KAAK,CAACO,KAHT,EAIE;AAEFsB,WAAK,CAACK,KAANL,GAAc,SAAdA;;AAEA,UAAIG,aAAa,CAACE,KAAdF,CAAoBvB,OAAxB,EAAiC;AAC/B,YAAM4B,OAAO,GAAG,IAAIC,KAAJ,EAAhB;AACAD,eAAO,CAAClB,GAARkB,GAAcL,aAAa,CAACE,KAAdF,CAAoBvB,OAAlC4B;AACAE,mBAAW,CAACF,OAAD,EAAU,IAAV,CAAXE;AACD;;AAED,UAAI,CAACP,aAAa,CAACE,KAAdF,CAAoBb,GAAzB,EAA8B;AAE9BhC,cAAQ,CAAC,YAAM;AAAA;;AACbsC,YAAI,CAAC,WAAD,EAAc,sBAAK,CAACS,KAAN,kCAAaP,UAAb,KAA2BK,aAAa,CAACE,KAAdF,CAAoBb,GAA7D,CAAJM;;AAEA,6BAAIG,KAAK,CAACM,KAAV,aAAIM,cAAaC,QAAjB,EAA2B;AACzB,cAAI,CAACb,KAAK,CAACM,KAANN,CAAYE,YAAjB,EAA+B;AAC7BY,mBAAO;AACR;;AAED,cAAIb,KAAK,CAACK,KAANL,KAAgB,OAApB,EAA6B;AAE7B,cAAI,CAAC5B,WAAW,CAACiC,KAAjB,EAAwBK,WAAW,CAACX,KAAK,CAACM,KAAP,EAAc,IAAd,CAAXK;AACxBI,gBAAM;AARR,eASO;AACL,cAAI,CAAC1C,WAAW,CAACiC,KAAjB,EAAwBK,WAAW,CAACX,KAAK,CAACM,KAAP,CAAXK;AACxBK,gBAAM;AACP;AAfK,QAARzD;AAiBD;;AAED,aAASwD,MAAT,GAAmB;AAAA;;AACjBC,YAAM;AACNf,WAAK,CAACK,KAANL,GAAc,QAAdA;AACAJ,UAAI,CAAC,MAAD,EAAS,uBAAK,CAACS,KAAN,mCAAaP,UAAb,KAA2BK,aAAa,CAACE,KAAdF,CAAoBb,GAAxD,CAAJM;AACD;;AAED,aAASiB,OAAT,GAAoB;AAAA;;AAClBb,WAAK,CAACK,KAANL,GAAc,OAAdA;AACAJ,UAAI,CAAC,OAAD,EAAU,uBAAK,CAACS,KAAN,mCAAaP,UAAb,KAA2BK,aAAa,CAACE,KAAdF,CAAoBb,GAAzD,CAAJM;AACD;;AAED,aAASmB,MAAT,GAAmB;AACjB,UAAMC,GAAG,GAAGjB,KAAK,CAACM,KAAlB;AACA,UAAIW,GAAJ,EAASlB,UAAU,CAACO,KAAXP,GAAmBkB,GAAG,CAAClB,UAAJkB,IAAkBA,GAAG,CAAC1B,GAAzCQ;AACV;;AAED,aAASY,WAAT,CAAsBM,GAAtB,EAA2E;AAAA,UAA9BC,OAA8B,uEAAL,GAAK;;AACzE,UAAMC,IAAI,GAAG,SAAPA,IAAO,GAAM;AACjB,YAAuBC,SAAvB,GAA6DH,GAA7D,CAAQd,aAAR;AAAA,YAAgDkB,QAAhD,GAA6DJ,GAA7D,CAAkCf,YAAlC;;AAEA,YAAIkB,SAAS,IAAIC,QAAjB,EAA2B;AACzBnB,sBAAY,CAACI,KAAbJ,GAAqBmB,QAArBnB;AACAC,uBAAa,CAACG,KAAdH,GAAsBiB,SAAtBjB;AAFF,eAGO,IAAI,CAACc,GAAG,CAACJ,QAAL,IAAiBZ,KAAK,CAACK,KAANL,KAAgB,SAAjC,IAA8CiB,OAAO,IAAI,IAA7D,EAAmE;AACxEI,oBAAU,CAACH,IAAD,EAAOD,OAAP,CAAVI;AADK,eAEA,IAAIL,GAAG,CAAClB,UAAJkB,CAAeM,QAAfN,CAAwB,MAAxBA,KAAmCA,GAAG,CAAClB,UAAJkB,CAAeO,UAAfP,CAA0B,oBAA1BA,CAAvC,EAAwF;AAC7Ff,sBAAY,CAACI,KAAbJ,GAAqB,CAArBA;AACAC,uBAAa,CAACG,KAAdH,GAAsB,CAAtBA;AACD;AAXH;;AAcAgB,UAAI;AACL;;AAED,QAAMM,cAAc,GAAGpE,QAAQ,CAAC;AAAA,aAAO;AACrC,6BAAqBe,KAAK,CAACK,KADU;AAErC,+BAAuB,CAACL,KAAK,CAACK;AAFO,OAAP;AAAA,KAAD,CAA/B;;AAKA,QAAMiD,OAAO,GAAGrE,QAAQ,CAAC,YAAM;AAAA;;AAC7B,UAAI,CAAC+C,aAAa,CAACE,KAAdF,CAAoBb,GAArB,IAA4BU,KAAK,CAACK,KAANL,KAAgB,MAAhD,EAAwD;AAExD,UAAMgB,GAAG,GAAG3D,CAAC,CAAC,KAAD,EAAQ;AACnBqE,iBAAO,CAAC,YAAD,EAAeF,cAAc,CAACnB,KAA9B,CADY;AAEnBf,WAAG,EAAEa,aAAa,CAACE,KAAdF,CAAoBb,GAFN;AAGnBC,cAAM,EAAEY,aAAa,CAACE,KAAdF,CAAoBZ,MAHT;AAInBF,aAAK,EAAElB,KAAK,CAACkB,KAJM;AAKnB7B,WAAG,EAAEuC,KALc;AAMnBe,cANmB,EAMnBA,MANmB;AAOnBD;AAPmB,OAAR,CAAb;AAUA,UAAMc,OAAO,qBAAG9B,KAAK,CAAC8B,OAAT,qBAAGC,0BAAhB;AAEA;AAAA,sBACgCzD,KAAK,CAAC0D,UADtC;AAAA;AAAA;AAAA;AAAA,kBAGMlE,cAAc,CACZgE,OAAO;AAAA,qBACY;AADZ,cAC+BA,OAD/B,EAC0CX,GAD1C,KAEHA,GAHQ,EAIZ,CAAC,CAACvD,KAAD,EAAQuC,KAAK,CAACK,KAANL,KAAgB,QAAxB,CAAD,CAJY,CAHpB;AAAA;AAAA;AAfsB,MAAxB;;AA6BA,QAAM8B,cAAc,GAAG1E,QAAQ,CAAC;AAAA;AAAA,sBACAe,KAAK,CAAC0D;AADN;AAAA;AAAA,kBAE1B1B,aAAa,CAACE,KAAdF,CAAoBvB,OAApBuB,IAA+BH,KAAK,CAACK,KAANL,KAAgB,QAA/CG;AAAA,qBAES,CAAC,YAAD,EAAe,qBAAf,EAAsCqB,cAAc,CAACnB,KAArD,CAFT;AAAA,mBAGQF,aAAa,CAACE,KAAdF,CAAoBvB,OAH5B;AAAA,mBAIM;AAJN,kBAF0B;AAAA;AAAA;AAAA,KAAD,CAA/B;;AAYA,QAAMmD,aAAa,GAAG3E,QAAQ,CAAC,YAAM;AACnC,UAAI,CAACyC,KAAK,CAACmC,WAAX,EAAwB;AAExB;AAAA,sBACgC7D,KAAK,CAAC0D,UADtC;AAAA;AAAA;AAAA;AAAA,kBAEM,CAAC7B,KAAK,CAACK,KAANL,KAAgB,SAAhBA,IAA8BA,KAAK,CAACK,KAANL,KAAgB,OAAhBA,IAA2B,CAACH,KAAK,CAACoC,KAAjE;AAAA,qBACS;AADT,cACgCpC,KAAK,CAACmC,WAANnC,EADhC,EAFN;AAAA;AAAA;AAH4B,MAA9B;;AAYA,QAAMqC,OAAO,GAAG9E,QAAQ,CAAC,YAAM;AAC7B,UAAI,CAACyC,KAAK,CAACoC,KAAX,EAAkB;AAElB;AAAA,sBACgC9D,KAAK,CAAC0D,UADtC;AAAA;AAAA;AAAA;AAAA,kBAEM7B,KAAK,CAACK,KAANL,KAAgB,OAAhBA;AAAA,qBACW;AADX,cAC4BH,KAAK,CAACoC,KAANpC,EAD5B,EAFN;AAAA;AAAA;AAHsB,MAAxB;;AAYA,QAAMsC,UAAU,GAAG/E,QAAQ,CAAC,YAAM;AAChC,UAAI,CAACe,KAAK,CAACQ,QAAX,EAAqB;AAErB;AAAA,iBAAkB,iBAAlB;AAAA,iBAA2C;AAAEyD,yBAAe,4BAAqBjE,KAAK,CAACQ,QAA3B;AAAjB;AAA3C;AAHyB,MAA3B;;AAMA,QAAM0D,QAAQ,GAAG7E,GAAG,CAAC,KAAD,CAApB;AACA;AACE,UAAM8E,IAAI,GAAG5E,KAAK,CAACU,WAAD,EAAcmE,aAAG,EAAI;AACrC,YAAIA,GAAJ,EAAS;AACP;AACAC,+BAAqB,CAAC,YAAM;AAC1BA,iCAAqB,CAAC,YAAM;AAC1BH,sBAAQ,CAAChC,KAATgC,GAAiB,IAAjBA;AADmB,cAArBG;AADmB,YAArBA;AAKAF,cAAI;AACL;AATe,QAAlB;AAWD;AAEDvE,aAAS,CAAC;AAAA;AAAA,iBAEC,CACL,OADK,EAEL;AAAE,4BAAkB,CAACsE,QAAQ,CAAChC;AAA9B,SAFK,CAFD;AAAA,iBAMC;AAAEb,eAAK,EAAE5B,aAAa,CAACO,KAAK,CAACqB,KAANrB,KAAgB,MAAhBA,GAAyB8B,YAAY,CAACI,KAAtClC,GAA8CA,KAAK,CAACqB,KAArD;AAAtB,SAND;AAAA,uBAOQpB,WAAW,CAACiC,KAPpB;AAAA,sBAQOlC,KAAK,CAACI,GARb;AAAA,gBASCJ,KAAK,CAACI,GAANJ,GAAY,KAAZA,GAAoBe;AATrB,SAcG;AACPuD,kBAAU,EAAE;AAAA,iBAAM,CAAChB,OAAO,CAACpB,KAAT,EAAgByB,cAAc,CAACzB,KAA/B,EAAsC8B,UAAU,CAAC9B,KAAjD,EAAwD0B,aAAa,CAAC1B,KAAtE,EAA6E6B,OAAO,CAAC7B,KAArF,CAAN;AAAA,SADL;AAEPrB,mBAASa,KAAK;AAFP,OAdH,qCAUQ;AACZ6C,eAAO,EAAEpC,IADG;AAEZzB,eAAO,EAAEV,KAAK,CAACU;AAFH,OAVR,EAaH,IAbG;AAAA8D;AAAA;AAAA,KAAD,CAAT5E;AAqBA,WAAO;AACL+B,gBADK,EACLA,UADK;AAELC,WAFK,EAELA,KAFK;AAGLC,WAHK,EAGLA,KAHK;AAILC,kBAJK,EAILA,YAJK;AAKLC;AALK,KAAP;AAOD;AAjQiC,CAAD,CAA5B","names":["VResponsive","intersect","makeTransitionProps","MaybeTransition","computed","h","nextTick","onBeforeMount","ref","vShow","watch","withDirectives","convertToUnit","defineComponent","SUPPORTS_INTERSECTION","useRender","VImg","name","directives","props","aspectRatio","String","Number","alt","cover","Boolean","eager","gradient","lazySrc","options","type","Object","default","root","undefined","rootMargin","threshold","sizes","src","srcset","width","emits","setup","_ref","emit","slots","currentSrc","image","state","naturalWidth","naturalHeight","normalisedSrc","aspect","value","init","isIntersecting","lazyImg","Image","pollForSize","_image$value2","complete","onError","onLoad","getSrc","img","timeout","poll","imgHeight","imgWidth","setTimeout","endsWith","startsWith","containClasses","__image","class","sources","_slots$sources","transition","__preloadImage","__placeholder","placeholder","error","__error","__gradient","backgroundImage","isBooted","stop","val","requestAnimationFrame","additional","handler","once"],"sources":["../../../src/components/VImg/VImg.tsx"],"sourcesContent":["import './VImg.sass'\n\n// Components\nimport { VResponsive } from '@/components/VResponsive'\n\n// Directives\nimport intersect from '@/directives/intersect'\n\n// Composables\nimport { makeTransitionProps, MaybeTransition } from '@/composables/transition'\n\n// Utilities\nimport {\n  computed,\n  h,\n  nextTick,\n  onBeforeMount,\n  ref,\n  vShow,\n  watch,\n  withDirectives,\n} from 'vue'\nimport {\n  convertToUnit,\n  defineComponent,\n  SUPPORTS_INTERSECTION,\n  useRender,\n} from '@/util'\n\n// Types\nimport type { PropType } from 'vue'\n\n// not intended for public use, this is passed in by vuetify-loader\nexport interface srcObject {\n  src?: string\n  srcset?: string\n  lazySrc?: string\n  aspect: number\n}\n\nexport const VImg = defineComponent({\n  name: 'VImg',\n\n  directives: { intersect },\n\n  props: {\n    aspectRatio: [String, Number],\n    alt: String,\n    cover: Boolean,\n    eager: Boolean,\n    gradient: String,\n    lazySrc: String,\n    options: {\n      type: Object as PropType<IntersectionObserverInit>,\n      // For more information on types, navigate to:\n      // https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API\n      default: () => ({\n        root: undefined,\n        rootMargin: undefined,\n        threshold: undefined,\n      }),\n    },\n    sizes: String,\n    src: {\n      type: [String, Object] as PropType<string | srcObject>,\n      default: '',\n    },\n    srcset: String,\n    width: [String, Number],\n\n    ...makeTransitionProps(),\n  },\n\n  emits: ['loadstart', 'load', 'error'],\n\n  setup (props, { emit, slots }) {\n    const currentSrc = ref('') // Set from srcset\n    const image = ref<HTMLImageElement>()\n    const state = ref<'idle' | 'loading' | 'loaded' | 'error'>(props.eager ? 'loading' : 'idle')\n    const naturalWidth = ref<number>()\n    const naturalHeight = ref<number>()\n\n    const normalisedSrc = computed<srcObject>(() => {\n      return props.src && typeof props.src === 'object'\n        ? {\n          src: props.src.src,\n          srcset: props.srcset || props.src.srcset,\n          lazySrc: props.lazySrc || props.src.lazySrc,\n          aspect: Number(props.aspectRatio || props.src.aspect),\n        } : {\n          src: props.src,\n          srcset: props.srcset,\n          lazySrc: props.lazySrc,\n          aspect: Number(props.aspectRatio || 0),\n        }\n    })\n    const aspectRatio = computed(() => {\n      return normalisedSrc.value.aspect || naturalWidth.value! / naturalHeight.value! || 0\n    })\n\n    watch(() => props.src, () => {\n      init(state.value !== 'idle')\n    })\n    // TODO: getSrc when window width changes\n\n    onBeforeMount(() => init())\n\n    function init (isIntersecting?: boolean) {\n      if (props.eager && isIntersecting) return\n      if (\n        SUPPORTS_INTERSECTION &&\n        !isIntersecting &&\n        !props.eager\n      ) return\n\n      state.value = 'loading'\n\n      if (normalisedSrc.value.lazySrc) {\n        const lazyImg = new Image()\n        lazyImg.src = normalisedSrc.value.lazySrc\n        pollForSize(lazyImg, null)\n      }\n\n      if (!normalisedSrc.value.src) return\n\n      nextTick(() => {\n        emit('loadstart', image.value?.currentSrc || normalisedSrc.value.src)\n\n        if (image.value?.complete) {\n          if (!image.value.naturalWidth) {\n            onError()\n          }\n\n          if (state.value === 'error') return\n\n          if (!aspectRatio.value) pollForSize(image.value, null)\n          onLoad()\n        } else {\n          if (!aspectRatio.value) pollForSize(image.value!)\n          getSrc()\n        }\n      })\n    }\n\n    function onLoad () {\n      getSrc()\n      state.value = 'loaded'\n      emit('load', image.value?.currentSrc || normalisedSrc.value.src)\n    }\n\n    function onError () {\n      state.value = 'error'\n      emit('error', image.value?.currentSrc || normalisedSrc.value.src)\n    }\n\n    function getSrc () {\n      const img = image.value\n      if (img) currentSrc.value = img.currentSrc || img.src\n    }\n\n    function pollForSize (img: HTMLImageElement, timeout: number | null = 100) {\n      const poll = () => {\n        const { naturalHeight: imgHeight, naturalWidth: imgWidth } = img\n\n        if (imgHeight || imgWidth) {\n          naturalWidth.value = imgWidth\n          naturalHeight.value = imgHeight\n        } else if (!img.complete && state.value === 'loading' && timeout != null) {\n          setTimeout(poll, timeout)\n        } else if (img.currentSrc.endsWith('.svg') || img.currentSrc.startsWith('data:image/svg+xml')) {\n          naturalWidth.value = 1\n          naturalHeight.value = 1\n        }\n      }\n\n      poll()\n    }\n\n    const containClasses = computed(() => ({\n      'v-img__img--cover': props.cover,\n      'v-img__img--contain': !props.cover,\n    }))\n\n    const __image = computed(() => {\n      if (!normalisedSrc.value.src || state.value === 'idle') return\n\n      const img = h('img', {\n        class: ['v-img__img', containClasses.value],\n        src: normalisedSrc.value.src,\n        srcset: normalisedSrc.value.srcset,\n        sizes: props.sizes,\n        ref: image,\n        onLoad,\n        onError,\n      })\n\n      const sources = slots.sources?.()\n\n      return (\n        <MaybeTransition transition={ props.transition } appear>\n          {\n            withDirectives(\n              sources\n                ? <picture class=\"v-img__picture\">{ sources }{ img }</picture>\n                : img,\n              [[vShow, state.value === 'loaded']]\n            )\n          }\n        </MaybeTransition>\n      )\n    })\n\n    const __preloadImage = computed(() => (\n      <MaybeTransition transition={ props.transition }>\n        { normalisedSrc.value.lazySrc && state.value !== 'loaded' && (\n          <img\n            class={['v-img__img', 'v-img__img--preload', containClasses.value]}\n            src={ normalisedSrc.value.lazySrc }\n            alt=\"\"\n          />\n        )}\n      </MaybeTransition>\n    ))\n\n    const __placeholder = computed(() => {\n      if (!slots.placeholder) return\n\n      return (\n        <MaybeTransition transition={ props.transition } appear>\n          { (state.value === 'loading' || (state.value === 'error' && !slots.error)) &&\n          <div class=\"v-img__placeholder\">{ slots.placeholder() }</div>\n          }\n        </MaybeTransition>\n      )\n    })\n\n    const __error = computed(() => {\n      if (!slots.error) return\n\n      return (\n        <MaybeTransition transition={ props.transition } appear>\n          { state.value === 'error' &&\n            <div class=\"v-img__error\">{ slots.error() }</div>\n          }\n        </MaybeTransition>\n      )\n    })\n\n    const __gradient = computed(() => {\n      if (!props.gradient) return\n\n      return <div class=\"v-img__gradient\" style={{ backgroundImage: `linear-gradient(${props.gradient})` }} />\n    })\n\n    const isBooted = ref(false)\n    {\n      const stop = watch(aspectRatio, val => {\n        if (val) {\n          // Doesn't work with nextTick, idk why\n          requestAnimationFrame(() => {\n            requestAnimationFrame(() => {\n              isBooted.value = true\n            })\n          })\n          stop()\n        }\n      })\n    }\n\n    useRender(() => (\n      <VResponsive\n        class={[\n          'v-img',\n          { 'v-img--booting': !isBooted.value },\n        ]}\n        style={{ width: convertToUnit(props.width === 'auto' ? naturalWidth.value : props.width) }}\n        aspectRatio={ aspectRatio.value }\n        aria-label={ props.alt }\n        role={ props.alt ? 'img' : undefined }\n        v-intersect={[{\n          handler: init,\n          options: props.options,\n        }, null, ['once']]}\n        v-slots={{\n          additional: () => [__image.value, __preloadImage.value, __gradient.value, __placeholder.value, __error.value],\n          default: slots.default,\n        }}\n      />\n    ))\n\n    return {\n      currentSrc,\n      image,\n      state,\n      naturalWidth,\n      naturalHeight,\n    }\n  },\n})\n\nexport type VImg = InstanceType<typeof VImg>\n"]},"metadata":{},"sourceType":"module"}